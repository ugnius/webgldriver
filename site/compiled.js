function i(a){throw a;}var l=void 0,m=!0,p=null,q=!1;function aa(){return function(){}}var r,s={},ba=q,ca;function u(a,b){ca.innerHTML+=(b?'<p class="'+b+'">':"<p>")+a+"</p>"}function da(a,b,c){ba!==m&&(ba=m,b=b.split("/"),b=b[b.length-1],a=a+"  "+b+":"+c,u('<p class="error">'+a+"</p>"),c=new XMLHttpRequest,c.open("POST","post.php"),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send("data=err&msg="+a),ba=q)}
window.onload=function(){ca=document.getElementById("output");window.onerror=da;u("<h2>WebGL Driver (alpha)</h2>");u('<p>Made by <a href="https://www.facebook.com/UgniusKavaliauskas">Ugnius Kavaliauskas</a> and <a href="">Rimvydas Klementavi&#269;ius</a></p>');u("<p>Testing browser...</p>");u("<p>"+navigator.userAgent+"</p>");var a=q,b;b=document.createElement("canvas");b.getContext("experimental-webgl")||b.getContext("webgl")?u("WebGL is supported","success"):(u("WebGL is not supported!","error"),
a=m);window.MozWebSocket||window.WebSocket?u("WebSockets are supported","success"):(u("WebSockets are not supported!","error"),a=m);navigator.pointer||navigator.webkitPointer?u("Mouse Lock API is supported","success"):u("Mouse Lock API is not supported!","warning");navigator.gamepads||navigator.webkitGamepads?u("Gamepad API is supported","success"):u("Gamepad API is not supported!","warning");window.AudioContext||window.webkitAudioContext?u("Web Audio API is supported","success"):u("Web Audio API is not supported!",
"warning");a?u("Sorry, this game will not work here =/"):(u("Loading application..."),x.ig())};window.B=window.B||{};window.AudioContext=window.AudioContext||window.webkitAudioContext;function ea(){this.Zc=[];this.ke=q;this.Xa=[];this.ie=[];this.wc=[];this.je=[];this.uc=[];this.fe=[];this.ge=[];this.$c=[];this.vc=[];this.Tb=this.me=this.le=this.yc=this.xc=this.ed=this.dd=this.gd=this.fd=0;this.gb=this.Z=p;ia(this);this.Jc=navigator.pointer||navigator.webkitPointer?m:q;this.Be=navigator.gamepads||navigator.webkitGamepads?m:q}
function ia(a){navigator.pointer=navigator.pointer||navigator.webkitPointer;window.oncontextmenu=function(){return q};window.onkeydown=function(b){a.Xa[b.keyCode]||(a.wc[b.keyCode]=m);a.Xa[b.keyCode]=m;a.$c.push(b.keyCode);return b.keyCode===a.Od&&a.ke?(ja(a),q):a.Zc[b.keyCode]?m:q};window.onkeyup=function(b){a.Xa[b.keyCode]=q;a.je[b.keyCode]=m};window.onblur=function(){for(var b in a.Xa)a.Xa.hasOwnProperty(b)&&(a.Xa[b]&&(a.wc[b]=m),a.Xa[b]=q);a.Rf=q;a.Cg=m};window.onfocus=function(){a.Rf=m;a.Dg=
m};window.onmousedown=function(b){a.uc[b.button]||(a.fe[b.button]=m);a.uc[b.button]=m;return q};window.onmouseup=function(b){a.uc[b.button]=q;a.ge[b.button]=m};window.ondblclick=function(){return q};window.onmousemove=function(b){a.Jc&&(a.xc+=b.webkitMovementX,a.yc+=b.webkitMovementY);a.fd=b.clientX;a.gd=b.clientY};window.addEventListener("mousewheel",function(b){a.Tb+=b.wheelDelta/Math.abs(b.wheelDelta)},q);window.addEventListener("DOMMouseScroll",function(b){a.Tb-=b.detail/Math.abs(b.detail)},q)}
function ja(a){var b=document.body;b.webkitRequestFullScreen(b.ALLOW_KEYBOARD_INPUT);a.Jc&&navigator.pointer.lock(b,aa(),function(){i(Error("Failed to enable pointer lock"))})}function ka(){var a=x.input,b=[x.input.pf,x.input.Od,x.input.of,x.input.Nd],c;a.Zc=[];for(c=0;c<b.length;c++)a.Zc[b[c]]=m}function la(a,b){var c;for(c=0;c<a.vc.length;c++){var d=ma(a,a.vc[c]);""!==d&&(b+=d);a.vc[c]===a.Xc&&(b=b.slice(0,b.length-1))}return b}
function ma(a,b){switch(b){case a.Hd:return"a";case a.Id:return"b";case a.Jd:return"c";case a.Kd:return"d";case a.mf:return"e";case a.Nd:return"f";case a.qf:return"g";case a.sf:return"h";case a.tf:return"i";case a.uf:return"j";case a.vf:return"k";case a.Pd:return"l";case a.Qd:return"m";case a.Rd:return"n";case a.Sd:return"o";case a.xf:return"p";case a.Td:return"q";case a.Ud:return"r";case a.Vd:return"s";case a.zf:return"t";case a.Bf:return"u";case a.Xd:return"v";case a.Yd:return"w";case a.Cf:return"x";
case a.Df:return"y";case a.Zd:return"z";case a.Fd:return"1";case a.Gd:return"2";case a.ef:return"3";case a.ff:return"4";case a.gf:return"5";case a.hf:return"6";case a.jf:return"7";case a.kf:return"8";case a.lf:return"9";case a.df:return"0"}return""}function y(a,b){return a.ie[b]===m?m:q}function z(a,b){return a.Xa[b]===m?m:q}function na(a,b){return a.Z&&a.Z.axes&&a.Z.axes[b]!==l?a.Z.axes[b]:0}function oa(a,b){return a.Z&&a.Z.buttons&&a.Z.buttons[b]!==l?a.Z.buttons[b]:0}
function pa(a,b){var c=a.Z,d=a.gb;return c&&c.buttons&&c.buttons[b]!==l&&d&&d.buttons&&d.buttons[b]!==l&&0.1>=d.buttons[b]&&0.1<c.buttons[b]?m:q}r=ea.prototype;r.nf=112;r.pf=116;r.Od=122;r.of=123;r.df=48;r.Fd=49;r.Gd=50;r.ef=51;r.ff=52;r.gf=53;r.hf=54;r.jf=55;r.kf=56;r.lf=57;r.Hd=65;r.Id=66;r.Jd=67;r.Kd=68;r.mf=69;r.Nd=70;r.qf=71;r.sf=72;r.tf=73;r.uf=74;r.vf=75;r.Pd=76;r.Qd=77;r.Rd=78;r.Sd=79;r.xf=80;r.Td=81;r.Ud=82;r.Vd=83;r.zf=84;r.Bf=85;r.Xd=86;r.Yd=87;r.Cf=88;r.Df=89;r.Zd=90;r.qc=37;r.rc=39;
r.Wd=38;r.Ld=40;r.Md=13;r.Xc=8;r.yf=16;r.Af=9;r.wf=188;r.rf=190;r.$e=2;r.$d=0;r.ae=1;r.Pf=3;r.Kf=4;r.Mf=5;r.Lf=6;r.Nf=7;r.If=8;r.Of=12;r.Jf=13;r.be=14;r.ce=15;r.Ef=0;r.Ff=1;r.Gf=2;r.Hf=3;var qa,ra,sa,ta,ua;function va(){try{ta=new WebSocket(qa)}catch(a){}try{ta=new MozWebSocket(qa)}catch(b){}ta===p?console.log("WARNING: NetworkInterface::connect - WebSocket is not supported"):(ta.binaryType="arraybuffer",ta.onopen=wa,ta.onclose=xa,ta.onmessage=Aa,ua=1)}function wa(){console.log("INFO: NetworkInterface - succesfuly connected to "+qa);ua=2}
function xa(){0===sa?(sa=1,qa="ws://localhost:8001",va()):(console.log("WARNING: NetworkInterface::onclose - failed to connect to WebSockets server!"),ua=3)}function Aa(a){ra.push(a.data)};var x={},Ba=document.createElement("script");Ba.onload=function(){var a=new window.Bg;a.ag.style.cssText="position:fixed;right:0;bottom:0;z-index:10000";document.body.appendChild(a.ag);requestAnimationFrame(function c(){a.update();requestAnimationFrame(c)})};Ba.src="//rawgit.com/mrdoob/stats.js/master/build/stats.min.js";document.head.appendChild(Ba);window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;
x.ig=function(){x.loaded=0;x.ud=0;x.fg=0.002;x.frame=0;x.t=0;x.time=(new Date).getTime();x.hb=0;x.freeze=q;x.Hg=0;x.Ya=1;x.Ng=m;x.lb=m;x.Yg=m;x.Eb=m;x.focus=0.15;x.Lg=q;x.se=1;x.pe=5;x.Ma=1;x.Ga=10;x.ga=p;x.ya=0;x.Yc=1;x.de=2;x.yb=3;x.sc=4;x.z=x.ya;x.Ag="ws://"+(window.location.hostname||"localhost")+":8001";x.Bc=0;x.Ne=0;x.Me=0;x.Le=0;x.id=-1;x.K=[];x.Za=[];x.Na=[];x.md=[];x.Qc=[];window.onbeforeunload=x.Uc;x.hg();x.input=new ea;ka();x.input.ke=q;x.canvas=document.getElementById("canvas");x.$=new Ca(x.canvas,
{antialias:q,alpha:q});x.$!==p&&(window.addEventListener("resize",x.Ec,q),x.Ec(),A(x.$,"depth",m),A(x.$,"scene"),A(x.$,"left"),A(x.$,"right"),x.Ce=document.getElementById("help"),x.debug=document.getElementById("debug"),x.$f=document.getElementById("debug2"),x.$f.style.display="none",x.ga=new Da(x),x.ga.load(function(){x.lb||(x.Ce.style.display="none");ca.innerHTML="";u("<h2>WebGL Driver (alpha)</h2>");u('<p>Made by <a href="http://www.facebook.com/UgniusKavaliauskas">Ugnius Kavaliauskas</a> and <a href="http://www.facebook.com/rimvydas.klementavicius">Rimvydas Klementavi&#269;ius</a></p>');
x.$.d.clear(x.$.d.COLOR_BUFFER_BIT);x.canvas.style.display="inline";x.$.d.clearColor(1,1,1,1);window.requestAnimationFrame(x.Se,x.canvas)}))};x.Ec=function(){var a=x.$,b=window.innerWidth*x.Ma,c=window.innerHeight*x.Ma;a.canvas.width=b;a.width=b;a.canvas.height=c;a.height=c;a.pd=m;a.d.viewport(0,0,b,c);x.Ya=window.innerWidth/window.innerHeight;x.ga&&"function"===typeof x.ga.Pe&&x.ga.Pe(window.innerWidth,window.innerHeight)};x.Uc=function(){x.$.Uc();x.kg()};
x.kg=function(){"undefined"!==typeof localStorage&&localStorage.setItem("settings",window.JSON.stringify({fieldOfView:x.Eb,camMode:x.se,audioGain:x.pe,canvasScale:x.Ma,renderDis:x.Ga,help:x.lb}))};
x.hg=function(){if("undefined"!==typeof localStorage){var a=""+localStorage.getItem("settings");if(a&&(a=window.JSON.parse(a)))if(a.fieldOfView!==l&&(x.Eb=a.fieldOfView),a.camMode!==l&&(x.se=a.camMode),a.audioGain!==l&&(x.pe=a.audioGain),a.canvasScale!==l&&(x.Ma=a.canvasScale),a.renderDis!==l&&(x.Ga=a.renderDis),a.help!==l)x.lb=a.help}};
x.Se=function(a){var a=(new Date).getTime(),b=x.input;b.ie=b.wc;b.wc={};b.je={};b.fe={};b.ge={};!b.Jc||!navigator.pointer.isLocked?(b.dd=b.fd-b.le,b.ed=b.gd-b.me,b.le=b.fd,b.me=b.gd):(b.dd=b.xc,b.ed=b.yc,b.xc=0,b.yc=0);b.Tb=0;b.vc=b.$c;b.$c=[];b=x.input;if(b.Be){var c=(navigator.gamepads||navigator.webkitGamepads)[0],d=0;if(c!==l){b.gb===p&&(b.gb={},b.gb.buttons=[],b.gb.axes=[]);b.Z===p&&(b.Z={},b.Z.buttons=[],b.Z.axes=[]);if(b.Z){for(d=0;16>d;d++)b.gb.buttons[d]=b.Z.buttons[d];for(d=0;4>d;d++)b.gb.axes[d]=
b.Z.axes[d]}for(d=0;16>d;d++)b.Z.buttons[d]=c.buttons[d];for(d=0;4>d;d++)b.Z.axes[d]=c.axes[d]}}x.ga&&("function"===typeof x.ga.update&&x.ga.update(x.input,a),"function"===typeof x.ga.pb&&x.ga.pb(x.$));x.debug.innerHTML=x.ga.debug?"Triangles: "+x.Bc+"<br/>Server state: "+x.z+"<br/>ping average: "+x.ga.ob+"<br/>Network interface: "+ua+"<br/>uAmbientColor: "+s.qa.Kb(x.ga.e.c[s.a.S],2)+"<br/>uDirColor    : "+s.qa.Kb(x.ga.e.c[s.a.T],2)+"<br/>":"";x.Bc=0;y(x.input,x.input.nf)&&(x.lb=!x.lb,console.log(x.lb),
x.Ce.style.display=x.lb?"inline":"none");x.ud=0;x.frame++;window.requestAnimationFrame(x.Se,x.canvas)};
x.Vf=function(a,b){z(b,b.Wd)?(a.F+=0.22,1<a.F&&(a.F=1)):a.F=0.1>=a.F?0:a.F-0.1;z(b,b.Ld)?(a.v+=0.2,1<a.v&&(a.v=1)):a.v=0.2>a.v?0:a.v-0.2;z(b,b.qc)&&(a.q+=0.1);z(b,b.rc)&&(a.q-=0.1);!z(b,b.qc)&&!z(b,b.rc)&&(a.q=0.1>=Math.abs(a.q)?0:0<a.q?a.q-0.1:a.q+0.1);1<a.q&&(a.q=1);-1>a.q&&(a.q=-1);y(b,b.Gd)&&(a.s++,6<a.s&&(a.s=6));y(b,b.Fd)&&(a.s--,-1>a.s&&(a.s=-1));if(b.Be&&(0.02<oa(b,6)&&(a.v=oa(b,6)),0.02<oa(b,7)&&(a.F=oa(b,7)),0.05<Math.abs(na(b,0))))a.q=-na(b,0)};
x.bf=function(a,b,c,d){var e,f,g,h,c=(c||1/60)*(d||100),d=a.rotation[0];e=a.rotation[1];f=a.position[0];g=a.position[1];h=a.position[2];z(b,b.Hd)&&(f-=Math.cos(-e)*c,h-=Math.sin(-e)*c);z(b,b.Kd)&&(f+=Math.cos(-e)*c,h+=Math.sin(-e)*c);z(b,b.Vd)&&(f-=Math.sin(-e)*c,h+=Math.cos(-e)*c);z(b,b.Yd)&&(f+=Math.sin(-e)*c,h-=Math.cos(-e)*c);z(b,b.Td)&&(g+=c);z(b,b.Zd)&&(g-=c);if(b.Jc&&navigator.pointer.isLocked||b.uc[b.$e])e-=0.005*b.dd,d-=0.005*b.ed;a.setPosition(f,g,h);Ea(a,d,e)};
x.cf=function(a,b,c){var d,e,f,g,h,c=400*(c||1/60);d=a.rotation[0];e=a.rotation[1];f=a.position[0];g=a.position[1];h=a.position[2];var j=na(b,b.Gf),k=na(b,b.Hf),o=na(b,b.Ef),n=na(b,b.Ff),o=0.5*s.ma(Math.abs(o)-0.05,0,1)*s.qb(o)*c,n=0.5*s.ma(Math.abs(n)-0.05,0,1)*s.qb(n)*c;f-=Math.sin(-e)*n-Math.cos(-e)*o;h+=Math.cos(-e)*n+Math.sin(-e)*o;g+=4*(oa(b,b.Nf)-oa(b,b.Lf));e-=0.01*s.ma(Math.abs(j)-0.1,0,1)*s.qb(j)*c;d-=0.01*s.ma(Math.abs(k)-0.1,0,1)*s.qb(k)*c;1.5<d&&(d=1.5);-1.5>d&&(d=-1.5);a.setPosition(f,
g,h);Ea(a,d,e)};"undefined"!==typeof exports?global.B=global.B||{}:window.B=window.B||{};
function Ca(a,b){if(!a||"function"!==typeof a.getContext)this.d=p;else{this.d=a.getContext("experimental-webgl",b)||a.getContext("webgl",b);this.canvas=a;this.canvas.style.display="none";this.R=q;this.za=p;this.D={};this.vb={};this.cc={};this.Ra={};this.d.clearColor(0.14,0.14,0.14,1);this.d.enable(this.d.DEPTH_TEST);this.d.blendFunc(this.d.SRC_ALPHA,this.d.ONE_MINUS_SRC_ALPHA);this.d.enable(this.d.CULL_FACE);this.width=this.canvas.width;this.height=this.canvas.height;this.pd=q;this.Pa=m;this.La=q;
this.De=p;this.activeTexture=0;this.re=[];var c=new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,-1,0,1,1,0,-1,1,0]);this.Ka=this.d.createBuffer();this.d.bindBuffer(this.d.ARRAY_BUFFER,this.Ka);this.d.bufferData(this.d.ARRAY_BUFFER,c,this.d.STATIC_DRAW);this.d.getExtension("OES_texture_float")}}
Ca.prototype.Uc=function(){var a=this.d,b,c;for(b in this.Ra)this.Ra.hasOwnProperty(b)&&(c=this.Ra[b],a.deleteFramebuffer(c.Qa),a.deleteTexture(c.Y),a.deleteRenderbuffer(c.Pc));for(b in this.vb)this.vb.hasOwnProperty(b)&&a.deleteTexture(this.vb[b].Y)};Ca.prototype.pb=function(a,b){var c=this.d,d;a.ld&&c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);for(d=0;d<a.ha.length;d++)c=a.ha[d],Fa(this,a,b,c,d);for(d=0;d<a.jb.length;d++)c=a.jb[d],Fa(this,a,b,c,d)};
function Fa(a,b,c,d,e){var f=a.d,g,h,j;if(d.ua&&(d.k.R&&d.oa.R)&&(x.ga.Qe%16===e%16&&(d.kb=d.L&&s.qa.lg(c.position,d.m)>0.1*d.L*x.Ga),!d.kb)){a.za!==d.oa&&(f.useProgram(d.oa.X),a.za=d.oa,f.uniformMatrix4fv(d.oa.Ba,q,c.Fc()));c.ea===m&&f.uniformMatrix4fv(d.oa.Ba,q,c.Fc());f.uniformMatrix4fv(d.oa.w,q,Ga(d));d.oa.fa&&f.uniformMatrix3fv(d.oa.fa,q,d.fa);for(j=0;j<d.oa.Dd;j++)switch(e=d.oa.Q[j],g=d.oa.M[j],h=d.c[e]||d.k.c[e]||b.c[e]||c.c[e],h===l&&i(Error('Object has undefined uniform: "'+s.H[e]+'", "'+
d.k.ca+'"')),s.I[e]){case 10:f.uniform3fv(g,h);break;case 11:f.uniform4fv(g,h);break;case 0:f.uniform1f(g,h);break;case 4:f.uniform1i(g,h);break;default:i(Error("Bad unifrom type: "+s.I[e]+", "+s.I[e]))}d.Pa===q?a.Pa===m&&(a.Pa=q,f.disable(f.CULL_FACE)):a.Pa===q&&(a.Pa=m,f.enable(f.CULL_FACE));d.La===m?a.La===q&&(a.La=m,f.enable(f.BLEND)):a.La===m&&(a.La=q,f.disable(f.BLEND));d.k.ba&&d.text===l&&(x.Bc+=d.k.ba);d.k.zc(f,d.oa,d)}}
function Ha(a,b,c){var d=a.d,e=C(a,"depth");if(e.R){d.useProgram(e.X);a.za=e;d.uniformMatrix4fv(e.Ba,q,c.Fc());for(a=0;a<b.ha.length;a++)if(c=b.ha[a],c.ua&&c.k.R&&c.k.zb){if(c.kb)return;d.uniformMatrix4fv(e.w,q,Ga(c));x.ud++;c.k.zb(d,e,c)}for(a=0;a<b.jb.length;a++)if(c=b.jb[a],c.ua&&c.k.R&&c.k.zb){if(c.kb)break;d.uniformMatrix4fv(e.w,q,Ga(c));x.ud++;c.k.zb(d,e,c)}}}
function Ia(a,b,c,d){this.d=a;this.Qa=a.createFramebuffer();this.Y=a.createTexture();this.Pc=a.createRenderbuffer();this.width=b;this.height=c;this.type=d===m?a.FLOAT:a.UNSIGNED_BYTE;a.bindFramebuffer(a.FRAMEBUFFER,this.Qa);a.bindTexture(a.TEXTURE_2D,this.Y);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);
a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,this.type,p);a.bindRenderbuffer(a.RENDERBUFFER,this.Pc);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.Y,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.Pc);a.bindTexture(a.TEXTURE_2D,p);a.bindRenderbuffer(a.RENDERBUFFER,p);a.bindFramebuffer(a.FRAMEBUFFER,p)}
function A(a,b,c){var d=a.width,e=a.height;a.Ra[b]||(a.Ra[b]=new Ia(a.d,d,e,c));return a.Ra[b]}
function Ja(a,b,c){"string"!==typeof b&&i("Wrong shader name!");if("undefined"!==typeof a.D[b])c&&c();else switch(b){case "color":a.D[b]=new D(a,"color.vsh","color.fsh",["aVerPosition"],[s.a.l],c);break;case "normal":a.D[b]=new D(a,"normal.vsh","normal.fsh",["aVerPosition","aVerNormal"],[s.a.S,s.a.T,s.a.eb,s.a.l],c);break;case "car":a.D[b]=new D(a,"car.vsh","car.fsh",["aVerPosition","aVerNormal","aTexCoord"],"uLightDirection uColor uTex0 uTex1 uTex2 uCamPosition".split(" "),c);break;case "add":a.D[b]=
new D(a,"add.vsh","add.fsh",["aVerPosition","aVerNormal","aTexCoord"],"uAmbientColor uDirColor uLightDirection uFog uColor uTex0 uTex1 uTex2 uCamPosition".split(" "),c);break;case "terrain":a.D[b]=new D(a,"terrain.vsh","terrain.fsh",["aVerPosition","aVerNormal","aTexCoord"],[s.a.eb,s.a.T,s.a.S,s.a.Pb,s.a.Qb,s.a.Ea],c);break;case "transparent":a.D[b]=new D(a,"transparent.vsh","transparent.fsh",["aVerPosition","aVerNormal","aTexCoord"],[s.a.eb,s.a.T,s.a.S,s.a.Pb,s.a.Qb,s.a.Ea],c);break;case "tree":a.D[b]=
new D(a,"tree.vsh","tree.fsh",["aVerPosition","aVerNormal","aTexCoord"],[s.a.eb,s.a.T,s.a.S,s.a.Pb,s.a.Qb,s.a.Cd,s.a.Ye,s.a.Ea],c);break;case "water":a.D[b]=new D(a,"water.vsh","water.fsh",["aVerPosition","aVerNormal","aTexCoord"],"uAmbientColor uDirColor uCamPosition uLightDirection uFog uTime uTex0".split(" "),c);break;case "multicol":a.D[b]=new D(a,"multicol.vsh","multicol.fsh",["aVerPosition","aVerNormal","aTexCoord"],[s.a.eb,s.a.S,s.a.T,s.a.Pb,s.a.Ea,s.a.oc,s.a.We,s.a.Xe,s.a.Ad],c);break;case "multicolroad":a.D[b]=
new D(a,"multicolroad.vsh","multicolroad.fsh",["aVerPosition","aVerNormal","aTexCoord"],"uLightDirection uAmbientColor uDirColor uFog uTex0 uTex1 uTex2 uTex3 uCamPosition".split(" "),c);break;case "sky":a.D[b]=new D(a,"sky.vsh","sky.fsh",["aVerPosition","aTexCoord"],["uAmbientColor","uDirColor","uTex0","uCamPosition","uTime"],c);break;case "text":a.D[b]=new D(a,"text.vsh","text.fsh",["aVerPosition","aVerNormal"],[s.a.S,s.a.T,s.a.eb,s.a.l,s.a.nc],c);break;case "vignette":a.D[b]=new D(a,"vignette.vsh",
"vignette.fsh",["aVerPosition"],["uColor","uStrength"],c);break;case "fade":a.D[b]=new D(a,"fade.vsh","fade.fsh",["aVerPosition"],[s.a.Ue],c);break;case "depth":a.D[b]=new D(a,"depth.vsh","depth.fsh",["aVerPosition"],["uOffset"],c);break;case "rbuffer":a.D[b]=new D(a,"rbuffer.vsh","rbuffer.fsh",["aVerPosition"],["uTex0"],c);break;case "colormap":a.D[b]=new D(a,"colormap.vsh","colormap.fsh",["aVerPosition"],["uTex0","uTex1","uStrength"],c);break;case "aberration":a.D[b]=new D(a,"aberration.vsh","aberration.fsh",
["aVerPosition"],["uTex0","uStrength"],c);break;case "blend":a.D[b]=new D(a,"blend.vsh","blend.fsh",["aVerPosition"],["uTex0","uStrength"],c);break;case "3d":a.D[b]=new D(a,"3d.vsh","3d.fsh",["aVerPosition"],["uTex0","uTex1"],c);break;case "vgauss":a.D[b]=new D(a,"vgauss.vsh","vgauss.fsh",["aVerPosition"],["uTex0","uTex1","uBlur","uFocus"],c);break;case "hgauss":a.D[b]=new D(a,"hgauss.vsh","hgauss.fsh",["aVerPosition"],["uTex0","uTex1","uBlur","uFocus"],c);break;default:i("Unkonwn shader "+b)}}
function C(a,b){"string"!==typeof b&&i("Wrong shader name!");"undefined"===typeof a.D[b]&&Ja(a,b);return a.D[b]}function Ka(a,b,c,d,e){"string"!==typeof b&&i("Wrong texture url name!");"undefined"!==typeof a.vb[b]?c&&c():a.vb[b]=new La(a.d,"textures/"+b,c,d,e)}function G(a,b,c,d){"string"!==typeof b&&i("Wrong texture name!");"undefined"===typeof a.vb[b]&&Ka(a,b,p,c,d);return a.vb[b]}
function Ma(a,b,c,d){"string"!==typeof b&&i('Wrong mesh url! "'+b+'"');"undefined"!==typeof a.cc[b]?"function"===typeof d&&d():a.cc[b]=new Na(a.d,"obj/"+b,c,d)}function I(a,b){"string"!==typeof b&&i('Wrong mesh url! "'+b+'"');"undefined"===typeof a.cc[b]&&Ma(a,b);return a.cc[b]}
function La(a,b,c,d,e){var f=this;this.d=a;this.url=b;this.fb=c||p;this.He=d===q?q:m;this.alpha=e===m?m:q;this.Y=a.createTexture();this.bc=new Image;this.bc.onload=function(){var a=f.d;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1);a.bindTexture(a.TEXTURE_2D,f.Y);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,f.He===m?a.LINEAR_MIPMAP_NEAREST:a.LINEAR);f.alpha===m?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.bc):a.texImage2D(a.TEXTURE_2D,
0,a.RGB,a.RGB,a.UNSIGNED_BYTE,f.bc);f.He===m&&a.generateMipmap(a.TEXTURE_2D);f.R=m;f.fb!==p&&(f.fb(),f.fb=p)};this.bc.onerror=function(){i('Error while loading image "'+b+'"')};this.bc.src=this.url;this.R=q}
function D(a,b,c,d,e,f){this.he=a;this.Ja=a.d;this.Ac=b;this.Qf=c;this.ee=d;this.jd=e;this.fb=f||p;this.R=q;this.attributes={};this.Ub=[];this.X=this.Ja.createProgram();this.bd=this.kd=p;this.Dd=0;this.Q=[];this.M=[];Oa(this,this.Ja.VERTEX_SHADER,"shaders/"+b);Oa(this,this.Ja.FRAGMENT_SHADER,"shaders/"+c)}
function Oa(a,b,c){s.Hc(c,function(c){var e=a.Ja,f=e.createShader(b);e.shaderSource(f,c);e.compileShader(f);e.getShaderParameter(f,e.COMPILE_STATUS)||i(Error('ERROR: CGLC:initShaders - failed to compile shader: "'+(b===e.VERTEX_SHADER?a.Ac:a.Qf)+'"\n'+e.getShaderInfoLog(f)+e.deleteShader(f)));b===e.VERTEX_SHADER&&(a.kd=f);b===e.FRAGMENT_SHADER&&(a.bd=f);if(!(a.kd===p||a.bd===p)){var c=a.Ja,g;c.attachShader(a.X,a.kd);c.attachShader(a.X,a.bd);c.linkProgram(a.X);if(c.getProgramParameter(a.X,c.LINK_STATUS)){for(e=
0;e<a.ee.length;e++)g=a.ee[e].toString(),f=a.attributes[g]=c.getAttribLocation(a.X,g),-1!==f?(c.enableVertexAttribArray(a.attributes[g]),a.Ub[f]=m):console.error('ERROR: Could not get attribute location "'+g+'"');for(e=0;e<a.jd.length;e++)f=a.jd[e],"string"===typeof f&&(f=s.H.indexOf(f),-1===f&&i(Error('shader uniform definition by string "'+a.jd[e]+'" was not found! '+a.Ac))),f===l&&i(Error("shader uniform "+(e+1)+" id is undefined! "+a.Ac)),g=s.H[f],a.Q.push(f),a.M.push(c.getUniformLocation(a.X,
g)),a.M[a.Dd]===p&&console.log('WARNING: shader program "'+a.Ac+'" has undefined variable "'+g+'" '+f),a.Dd++;a.Ba=c.getUniformLocation(a.X,"uPMatrix");a.w=c.getUniformLocation(a.X,"uMVMatrix");a.fa=c.getUniformLocation(a.X,"uNMatrix");for(g in a.attributes)a.attributes[g]===p&&console.log('WARNING: shader program has undefined variable "'+g+'"');a.R=m;"function"===typeof a.fb&&(a.fb(),a.fb=p)}else console.error("ERROR: Could not initialise shaders!")}})}
function Pa(a,b){var c=a.attributes[b];c===l?console.warn("Bad shader attribute name!"):a.Ub[c]===q&&(a.Ja.enableVertexAttribArray(c),a.Ub[c]=m)}function J(a,b,c,d){var e=a.Ja,f=a.he,a=a.attributes[b];a===l&&i(Error('Bad shader attribute name "'+b+'"'));f.De!==c&&(e.bindBuffer(e.ARRAY_BUFFER,c),f.De=c,e.vertexAttribPointer(a,d,e.FLOAT,q,0,0))}
D.prototype.bindTexture=function(a,b){var c=this.he,d=this.Ja;c.re[a]!==b&&(c.activeTexture!==a&&(d.activeTexture(a+33984),c.activeTexture=a),d.bindTexture(d.TEXTURE_2D,b),c.re[a]=b)};function Qa(){this.ha=[];this.jb=[];this.c=[];this.ld=q}Qa.prototype.add=function(a,b){"function"===typeof a.ne?a.ne(this):b===m?this.jb.push(a):this.ha.push(a)};s.af=aa();s.af.prototype.Fc=aa();
function Ra(a,b,c,d){this.ze=a;this.Ya=b;this.Ie=c;this.kb=d;this.c=[];this.position=K.create();this.rotation=K.create();this.G=K.create();this.Je=K.create();this.mc=K.create();this.Ba=L.create();this.ea=m}
Ra.prototype.cd=function(){var a=this.position,b=this.rotation;L.Oe(this.ze,this.Ya,this.Ie,this.kb,this.Ba);L.rotate(this.Ba,-b[0],[1,0,0]);L.rotate(this.Ba,-b[1],[0,1,0]);L.rotate(this.Ba,-b[2],[0,0,1]);K.scale(a,-1,this.Je);L.translate(this.Ba,this.Je);this.c[s.a.Ad]=[a[0],a[1],a[2]];this.ea=q};Ra.prototype.setPosition=function(a,b,c){var d=this.position;d[0]===a&&d[1]===b&&d[2]===c||(d[0]=a,d[1]=b,d[2]=c,this.ea=m)};
function Ea(a,b,c){var d=a.rotation;d[0]===b&&d[1]===c&&0===d[2]||(d[0]=b,d[1]=c,d[2]=0,a.ea=m)}Ra.prototype.Fe=function(a,b,c){var a=a-this.position[0],b=b-this.position[1],c=c-this.position[2],d;d=Math.atan(a/c);0<c&&(d+=Math.PI);Ea(this,Math.atan(b/Math.sqrt(a*a+c*c)),d)};Ra.prototype.Fc=function(){this.ea&&this.cd();return this.Ba};s.g=0;s.a={};s.H=[];s.I=[];s.a.Wg=++s.g;s.H[s.g]="uPMatrix";s.I[s.g]=18;s.a.Ug=++s.g;s.H[s.g]="uMMatrix";s.I[s.g]=18;s.a.Vg=++s.g;s.H[s.g]="uNMatrix";s.I[s.g]=17;
s.a.eb=++s.g;s.H[s.g]="uLightDirection";s.I[s.g]=10;s.a.S=++s.g;s.H[s.g]="uAmbientColor";s.I[s.g]=10;s.a.T=++s.g;s.H[s.g]="uDirColor";s.I[s.g]=10;s.a.Pb=++s.g;s.H[s.g]="uFog";s.I[s.g]=0;s.a.Qb=++s.g;s.H[s.g]="uScale";s.I[s.g]=0;s.a.Ea=++s.g;s.H[s.g]="uTex0";s.I[s.g]=4;s.a.oc=++s.g;s.H[s.g]="uTex1";s.I[s.g]=4;s.a.We=++s.g;s.H[s.g]="uTex2";s.I[s.g]=4;s.a.Xe=++s.g;s.H[s.g]="uTex3";s.I[s.g]=4;s.a.l=++s.g;s.H[s.g]="uColor";s.I[s.g]=10;s.a.nc=++s.g;s.H[s.g]="uOffset";s.I[s.g]=4;s.a.Ue=++s.g;s.H[s.g]="uFade";
s.I[s.g]=0;s.a.Te=++s.g;s.H[s.g]="uBlur";s.I[s.g]=0;s.a.Ve=++s.g;s.H[s.g]="uFocus";s.I[s.g]=0;s.a.Cd=++s.g;s.H[s.g]="uTime";s.I[s.g]=0;s.a.Ad=++s.g;s.H[s.g]="uCamPosition";s.I[s.g]=10;s.a.Bd=++s.g;s.H[s.g]="uStrength";s.I[s.g]=0;s.a.Ye=++s.g;s.H[s.g]="uWindStrength";s.I[s.g]=0;"undefined"!==typeof exports?s=global.B=global.B||s:window.B=window.B||{};
function Da(a){this.b=a;this.time=(new Date).getTime()+6E4;this.hb=this.startTime=0;this.$a=0.002;this.Qe=this.t=0;this.xb="test";this.nb="blabla";this.Ke=0;this.debug=q;this.u=0;this.Gc=[0.507,-0.407,0.3];this.zg=[0.01,0.012,0.013];this.e=new Qa;this.e.ld=m;this.e.c[s.a.S]=[0.8,0.8,0.8];this.e.c[s.a.T]=[0.5,0.5,0.5];this.e.c[s.a.eb]=this.Gc;this.e.c[s.a.Pb]=[3E3];this.e.c[s.a.Qb]=[1];this.e.c[s.a.Cd]=[this.time];this.e.c[s.a.Ye]=[2];this.Ha=new Qa;this.Ha.ld=q;this.Ha.c[s.a.S]=[0.5,0.5,0.5];this.Ha.c[s.a.T]=
[0.5,0.5,0.5];this.Ha.c[s.a.eb]=this.Gc;this.Ha.c[s.a.Pb]=[2E3];this.Oa=[0.0390625,0.80859375,0];this.Db=[0,0.60546875,0.58203125];this.te=[0.99609375,0.44140625,0];this.nd=[0.98828125,0,0.0234375];this.C=new Ra(45,a.Ya,0.1,1E4);K.set([383.349,12.549,-354.146],this.C.position);K.set([0.06,-12.009,0],this.C.rotation);this.$b=new Ra(45,a.Ya,0.1,4E3);this.Aa=this.J=0;this.h=3;this.xa=1;this.Mc=this.la=this.p=this.Ta=this.aa=0;this.Hb=[];this.ob=0;this.f=[];this.Ua=L.create();this.na=new Sa;this.da=[];
this.va=L.create();L.Sa(this.va);L.translate(this.va,[196.7,4.5,-64.5]);L.rotate(this.va,0.807,[0,1,0]);this.Fa=aa();this.Sc=[];this.Jb=[];this.ic=this.Ca=0;this.Zb=[0,0,0];this.Rc=[1,1,1];this.Ee=0}r=Da.prototype;r.Pe=function(a,b){this.C.Ya=a/(0<b?b:1);this.C.ea=m;this.$b.Ya=a/(0<b?b:1);this.$b.ea=m};
r.load=function(a){var b=1,c=this.b.$,d=this,e,f;e=function(){b--;ca.innerHTML+=".";0===b&&"function"===typeof a?(a(),d.startTime=(new Date).getTime()):0>b&&u("Too much callbacks!","warn")};b++;Ja(c,"vignette",e);b++;Ja(c,"fade",e);b++;Ja(c,"normal",e);b++;Ja(c,"text",e);b++;Ja(c,"car",e);b++;Ja(c,"terrain",e);b++;Ja(c,"normal",e);b++;Ja(c,"multicol",e);b++;Ja(c,"multicolroad",e);b++;Ja(c,"sky",e);b++;Ja(c,"transparent",e);b++;Ja(c,"add",e);b++;Ka(c,"zemelapio_tex.jpg",e);b++;Ka(c,"smelis_red.jpg",
e);b++;Ka(c,"uola_blue.jpg",e);b++;Ka(c,"zole_green.jpg",e);b++;Ka(c,"kelias.png",e);b++;Ka(c,"betonas_red.jpg",e);b++;Ka(c,"sonas_asfalt_green.png",e);b++;Ka(c,"asphalt.jpg",e);b++;Ka(c,"water.jpg",e);b++;Ka(c,"dangus.jpg",e);b++;Ma(c,"isl.obj",m,e);b++;Ma(c,"road.obj",m,e);b++;Ma(c,"prpl.obj",m,e);b++;Ma(c,"water.obj",m,e);b++;Ma(c,"vsky.obj",q,e);b++;Ma(c,"b3.obj",q,e);b++;Ma(c,"arosa.obj",q,e);b++;c.cc["title.obj"]=new Ta(c.d,"obj/title.obj",e);f=new M(I(c,"isl.obj"),C(c,"multicol"));f.sb=G(c,
"zemelapio_tex.jpg");f.tb=G(c,"uola_blue.jpg");f.ub=G(c,"zole_green.jpg");f.Tc=G(c,"smelis_red.jpg");this.e.add(f);f=new M(I(c,"road.obj"),C(c,"multicolroad"));f.sb=G(c,"kelias.png");f.tb=G(c,"betonas_red.jpg");f.ub=G(c,"sonas_asfalt_green.png");f.Tc=G(c,"asphalt.jpg");this.e.add(f);f=new M(I(c,"prpl.obj"),C(c,"terrain"));f.sb=G(c,"betonas_red.jpg");f.c[s.a.Qb]=[40];this.e.add(f);f=new M(I(c,"vsky.obj"),C(c,"sky"));f.sb=G(c,"dangus.jpg");this.e.add(f);f=new M(I(c,"water.obj"),C(c,"water"));f.sb=G(c,
"water.jpg");f.c[s.a.Qb]=[100];this.e.add(f);for(f=0;7>f;f++)this.f[f]=new M(I(c,"title.obj"),C(c,"text")),this.f[f].c[s.a.l]=[0,0,0],K.set(this.Oa,this.f[f].c[s.a.l]),this.f[f].c[s.a.nc]=[0],this.f[f].text="xoxoxox",this.f[f].m[1]=-0.35*f,this.Ha.add(this.f[f]);N(this,0);for(f=0;3>f;f++)this.da[f]=new M(I(c,"title.obj"),C(c,"text")),this.da[f].c[s.a.l]=[0,0,0],K.set(this.te,this.da[f].c[s.a.l]),this.da[f].c[s.a.nc]=[0],this.da[f].text="xoxoxox",this.da[f].m[1]=-0.35*f,this.Ha.add(this.da[f]);this.na.ab.push(I(c,
"road.obj"));this.na.ab.push(I(c,"isl.obj"));this.na.ab.push(I(c,"prpl.obj"));this.na.ab.push(I(c,"water.obj"));I(c,"road.obj").Mb=0;I(c,"isl.obj").Mb=1;I(c,"prpl.obj").Mb=0;b++;O(this,"obj/obj.obj",e);b++;O(this,"obj/sviestuvai.obj",e);b++;O(this,"obj/kont.obj",e);b++;O(this,"obj/loc_laivas.obj",e);b++;O(this,"obj/loc_hotel.obj",e);b++;O(this,"obj/loc_dangoraizis.obj",e);b++;O(this,"obj/loc_dangoraizis2.obj",e);b++;O(this,"obj/loc_didelis_namas.obj",e);b++;O(this,"obj/loc_siena.obj",e);b++;O(this,
"obj/loc_tvora.obj",e);b++;O(this,"obj/loc_namas1.obj",e);b++;O(this,"obj/loc_namas2.obj",e);b++;O(this,"obj/loc_namas3.obj",e);b++;O(this,"obj/loc_namas4.obj",e);b++;O(this,"obj/loc_palme1.obj",e);b++;O(this,"obj/loc_svyturys.obj",e);b++;O(this,"obj/loc_pastatas1.obj",e);b++;O(this,"obj/loc_villa1.obj",e);b++;O(this,"obj/loc_perkunas.obj",e);b++;O(this,"obj/loc_villa2.obj",e);b++;O(this,"obj/loc_villa.obj",e);b++;O(this,"obj/loc_lektuvas.obj",e);b++;O(this,"obj/loc_angaras.obj",e);b++;O(this,"obj/loc_ktu.obj",
e);e()};r.Uc=function(a){"function"===typeof a&&a()};
function O(a,b,c){s.Hc(b,function(d){var e,f,g=[],h=a.b.$,j=K.create(),k="",d=d.split("\n");for(f=0;f<d.length;f++)if(0!==d[f].length&&(e=d[f].split(" "),0!==e.length))switch(e[0]){case "g":k=e[1].split(".")[0];break;case "v":4===e.length?(e=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])],!isNaN(e[0])&&!isNaN(e[1])&&!isNaN(e[2])?g.push(e):i(Error("Bad vertex data in "+b+":"+f))):i(Error("Wrong vertex data count in "+b+":"+f));break;case "f":if(4===e.length)if(e=[parseInt(e[1],10),parseInt(e[2],
10),parseInt(e[3],10)],!isNaN(e[0])&&!isNaN(e[1])&&!isNaN(e[2])){k=k.replace("_Plane","");switch(k){case "loc_angaras":e=new M(I(h,"angaras.obj"),C(h,"terrain"),G(h,"angaras.jpg"));e.L=500;a.e.add(e);break;case "loc_ktu":e=new M(I(h,"tktu.obj"),C(h,"terrain"),G(h,"ktu.jpg"));e.L=1E3;a.e.add(e);break;case "loc_medis1":e=new M(I(h,"medis.obj"),C(h,"tree"),G(h,"medis.png",q,m));e.La=m;e.Pa=q;e.L=500;a.e.add(e,m);break;case "loc_palme1":e=new M(I(h,"palme1.obj"),C(h,"tree"),G(h,"palme1.png",q,m));e.La=
m;e.Pa=q;e.L=500;a.e.add(e,m);break;case "loc_sviestuvas":e=new M(I(h,"sviestuvas.obj"),C(h,"terrain"),G(h,"sviestuvas.jpg"));e.L=300;a.e.add(e);break;case "loc_kont":e=new M(I(h,"konteineris.obj"),C(h,"terrain"),G(h,"konteineris.jpg"));e.L=500;a.e.add(e);break;case "loc_laivas":e=new M(I(h,"laivas.obj"),C(h,"terrain"),G(h,"laivas.png"));a.e.add(e);break;case "loc_hotel":e=new M(I(h,"hotel.obj"),C(h,"terrain"),G(h,"hotel.jpg"));a.e.add(e);break;case "loc_dangoraizis":e=new M(I(h,"dangoraizis.obj"),
C(h,"add"),G(h,"dangoraizis.png",q));e.tb=G(h,"dangoraizis_add.png",q);e.ub=G(h,"dangus.jpg",q);e.c[s.a.l]=[0,0,0];a.e.add(e);break;case "loc_dangoraizis2":e=new M(I(h,"dangoraizis2.obj"),C(h,"terrain"),G(h,"dangoraizis2.png",q));a.e.add(e);break;case "loc_didelis_namas":e=new M(I(h,"didelis_namas.obj"),C(h,"terrain"),G(h,"didelis_namas.jpg"));a.e.add(e);break;case "loc_siena":e=new M(I(h,"siena.obj"),C(h,"terrain"),G(h,"siena.jpg"));a.e.add(e);e.L=200;break;case "loc_namas1":e=new M(I(h,"namas1.obj"),
C(h,"terrain"),G(h,"namas1.jpg"));e.L=1E3;a.e.add(e);break;case "loc_namas2":e=new M(I(h,"namas2.obj"),C(h,"terrain"),G(h,"namas2.jpg"));e.L=1E3;a.e.add(e);break;case "loc_tvora":e=new M(I(h,"tvora.obj"),C(h,"transparent"),G(h,"tvora.png",q,m));e.La=m;e.Pa=q;e.L=200;a.e.add(e,m);break;case "loc_namas3":e=new M(I(h,"namas3.obj"),C(h,"terrain"),G(h,"namas3.jpg"));e.L=1E3;a.e.add(e);break;case "loc_namas4":e=new M(I(h,"namas4.obj"),C(h,"terrain"),G(h,"namas4.jpg"));e.L=1E3;a.e.add(e);break;case "loc_svyturys":e=
new M(I(h,"svyturys.obj"),C(h,"terrain"),G(h,"svyturys.png"));e.L=1E3;a.e.add(e);break;case "loc_perkunas":e=new M(I(h,"perkunas.obj"),C(h,"terrain"),G(h,"perkunas.jpg"));e.L=500;a.e.add(e);break;case "loc_pastatas1":e=new M(I(h,"pastatas1.obj"),C(h,"terrain"),G(h,"pastatas1.jpg"));a.e.add(e);break;case "loc_villa":e=new M(I(h,"villa.obj"),C(h,"terrain"),G(h,"villa.jpg"));e.L=500;a.e.add(e);break;case "loc_villa1":e=new M(I(h,"villa1.obj"),C(h,"terrain"),G(h,"villa1.jpg"));e.L=500;a.e.add(e);break;
case "loc_villa2":e=new M(I(h,"villa2.obj"),C(h,"terrain"),G(h,"villa2.jpg"));e.L=500;a.e.add(e);break;case "loc_lektuvas":e=new M(I(h,"lektuvas.obj"),C(h,"terrain"),G(h,"lektuvas.jpg"));e.L=500;a.e.add(e);break;default:u('Unknown object name "'+k+'"',"warn");g=[];continue}K.set(g[0],e.m);K.Da(g[0],g[1],j);var o=K.length(j),n=Math.atan(j[0]/j[2]);0<j[2]&&(n+=Math.PI);e.L*=e.L;if("loc_palme1"===k||"loc_medis1"===k)o*=2;L.Sa(e.w);L.translate(e.w,g[0]);L.rotate(e.w,n-Math.PI/2,[0,1,0]);L.Nb(e.w,e.fa);
P.wb(e.fa);L.scale(e.w,[o,o,o]);e.ea=q;g=[]}else i(Error("Bad vertex data in "+b+":"+f));else i(Error("Wrong face data count in "+b+":"+f))}"function"===typeof c&&c()})}
function N(a,b){switch(b){case 0:a.f[0].text="webgl driver";K.set(a.te,a.f[0].c[s.a.l]);a.f[1].text="user: "+a.xb;a.f[2].text="pass: "+Array(a.nb.length+1).join("*");a.f[3].text="login>";a.f[4].text="register>";a.f[5].text="options>";a.f[6].text="";K.set(a.nd,a.f[6].c[s.a.l]);break;case 1:a.f[0].text="options";a.f[2].text="video "+s.Lc(Math.floor(10*a.b.Ma).toString(),4);a.f[3].text="fov   "+(a.b.Eb?"  on":" off");a.f[4].text="render "+s.Lc(a.b.Ga.toString(),3);a.f[5].text="<back";a.f[6].text="";
break;case 2:a.f[0].text="game menu";a.f[1].text="continue";a.f[2].text="options";a.f[3].text="main menu";a.f[4].text="";a.f[5].text="";a.f[6].text="";break;case 3:a.f[0].text="choose your car";a.f[1].text="<name>";a.f[2].text="";a.f[3].text="";a.f[4].text="";a.f[5].text="";a.f[6].text="";break;default:a.f[0].text="",a.f[1].text="",a.f[2].text="",a.f[3].text="",a.f[4].text="",a.f[5].text="",a.f[6].text=""}}
function Ua(a,b,c){var d,e,f;f=y(b,b.Ld)||pa(b,b.Jf)||y(b,b.Af);var g=y(b,b.Wd)||pa(b,b.Of),h=y(b,b.qc)||pa(b,b.be);d=y(b,b.rc)||pa(b,b.ce);e=y(b,b.Md)||pa(b,b.$d);var j=y(b,b.Xc)||pa(b,b.ae),k=y(b,b.Pd)||pa(b,b.Pf);if(a.b.z===a.b.yb){-1===a.J&&j&&(a.J=2,N(a,a.J),a.h=-1,a.xa=1,a.p=-3,a.Fa=p);if(2===a.J&&0===a.p){f&&(a.h++,4<=a.h&&(a.h=1));g&&(a.h--,0>=a.h&&(a.h=3));if(1===a.h&&e||j)a.Aa=-1,a.p=3;if(2===a.h&&(e||d))a.Aa=1,a.xa=1,a.p=1;3===a.h&&e&&Va(a)}k&&u("logout")}0===a.J&&(1!==a.h&&2!==a.h&&0===
a.p&&a.b.z===a.b.ya&&j)&&(a.Aa=-1,a.p=3,a.xa=3,a.Fa=p);-1===a.J&&(0===a.p&&a.b.z===a.b.ya&&j)&&(a.J=0,N(a,a.J),a.h=-1,a.xa=3,a.p=-3);if(0===a.J&&0===a.p&&a.b.z===a.b.ya){f&&(a.h++,6<=a.h&&(a.h=1));g&&(a.h--,0>=a.h&&(a.h=5));1===a.h&&(f=la(b,a.xb),f!==a.xb&&(10<f.length&&(f=f.slice(0,10)),a.xb=f,a.f[1].text="user: "+a.xb));2===a.h&&(f=la(b,a.nb),f!==a.nb&&(16<f.length&&(f=f.slice(0,16)),a.nb=f,a.f[2].text="pass: "+Array(a.nb.length+1).join("*")));if((1===a.h||2===a.h||3===a.h)&&e&&a.b.z===a.b.ya)2===
ua?""===a.xb||""===a.nb?a.f[6].text="enter fields":(a.b.z=a.b.Yc,a.f[6].text="logging in"):(a.f[6].text="server offline =\\",2>a.Ke?(a.Ke++,3===ua&&(qa=a.b.Ag,ra=[],sa=0,ta=p,va(),ua=0)):(a.f[6].text="fine, ok, go play",a.b.id=43,b=new Wa(-1),b.na=a.na,f=new Xa(b,a.b.$,a.debug),a.e.add(f),a.b.Za.push(b),a.b.Na.push(f),a.b.K[43]={},a.b.K[43].o=b,a.b.K[43].dc=f,a.b.z=a.b.yb,a.Aa=-1,a.p=3,a.Fa=function(){a.la=1}));4===a.h&&(e&&a.b.z===a.b.ya)&&(2===ua?""===a.xb||""===a.nb?a.f[6].text="enter fields":
(a.b.z=a.b.de,a.f[6].text="registering in"):a.f[6].text="server offline =\\");if(5===a.h&&(e||d))a.p=1,a.Aa=1,a.xa=1}else if(1===a.J&&0===a.p){f&&(a.h++,6<=a.h&&(a.h=1));g&&(a.h--,0>=a.h&&(a.h=5));1===a.h&&h&&N(a,1);1===a.h&&d&&N(a,1);2===a.h&&h&&(a.b.Ma=Math.floor(10*s.ma(a.b.Ma-0.1,0.1,2.6)+0.01)/10,a.b.Ec(),N(a,1));2===a.h&&d&&(a.b.Ma=Math.floor(10*s.ma(a.b.Ma+0.1,0.1,2.6)+0.01)/10,a.b.Ec(),N(a,1));if(3===a.h&&(h||d||e))a.b.Eb=!a.b.Eb,N(a,1);4===a.h&&h&&(a.b.Ga--,1>a.b.Ga&&(a.b.Ga=1),N(a,1));4===
a.h&&d&&(a.b.Ga++,10<a.b.Ga&&(a.b.Ga=10),N(a,1));if(j||5===a.h&&(e||h))a.b.z===a.b.ya?(a.J=0,a.xa=5):a.b.z===a.b.yb&&(a.J=2,a.xa=2),a.p=-1}1===a.p&&(a.aa+=20*c,5<=a.aa&&(a.J=a.Aa,N(a,a.J),a.h=-1,a.aa=-5,a.p=2));2===a.p&&(a.aa+=20*c,0<a.aa&&(a.h=a.xa,a.aa=0,a.p=0));-1===a.p&&(a.aa-=20*c,-5>=a.aa&&(N(a,a.J),a.h=-1,a.p=-2,a.aa=5));-2===a.p&&(a.aa-=20*c,0>a.aa&&(a.h=a.xa,a.aa=0,a.p=0));3===a.p&&(a.Ta+=10*c,2<a.Ta&&(a.p=0,a.J=a.Aa,N(a,a.Aa),"function"===typeof a.Fa&&a.Fa()));-3===a.p&&(a.Ta-=10*c,0>a.Ta&&
(a.h=a.xa,a.Ta=0,a.p=0));L.Sa(a.Ua);L.translate(a.Ua,[-1.8,0.8,-3.5]);L.rotate(a.Ua,-1.02,[0,1,0]);(2===a.J||1===a.J&&a.b.z===a.b.yb)&&L.scale(a.Ua,[0.5,0.5,0.5]);a.b.z===a.b.sc&&(L.Sa(a.Ua),L.translate(a.Ua,[-1.8,1.2,-3.5]),L.rotate(a.Ua,-1.02,[0,1,0]),L.scale(a.Ua,[0.5,0.5,0.5]));e=p;for(d=a.f.length-1;0<=d;d--)e=a.f[d],a.h===d?0.1>e.m[0]&&(e.m[0]+=0.6*c,0.1<e.m[0]&&(e.m[0]=0.1),e.c[s.a.l][0]=a.Oa[0]*(1-10*e.m[0])+a.Db[0]*10*e.m[0],e.c[s.a.l][1]=a.Oa[1]*(1-10*e.m[0])+a.Db[1]*10*e.m[0],e.c[s.a.l][2]=
a.Oa[2]*(1-10*e.m[0])+a.Db[2]*10*e.m[0]):0<e.m[0]&&(e.m[0]-=0.6*c,0>e.m[0]&&(e.m[0]=0),e.c[s.a.l][0]=a.Oa[0]*(1-10*e.m[0])+a.Db[0]*10*e.m[0],e.c[s.a.l][1]=a.Oa[1]*(1-10*e.m[0])+a.Db[1]*10*e.m[0],e.c[s.a.l][2]=a.Oa[2]*(1-10*e.m[0])+a.Db[2]*10*e.m[0]),L.set(a.Ua,e.w),L.translate(e.w,e.m),L.translate(e.w,[0,Math.pow(a.Ta,2)*s.qb(a.Ta),Math.pow(a.aa,2)*s.qb(a.aa)]),L.Nb(e.w,e.fa),P.wb(e.fa),0===d&&L.scale(e.w,[1.2,1.2,1.2]);a.b.K[a.b.id]?(b=a.b.K[a.b.id].o,c=3.6*((b.i[1].U*b.i[1].Ib+b.i[0].U*b.i[0].Ib)/
2),a.da[0].ua=m,a.da[1].ua=m,a.da[2].ua=q,a.da[0].text=s.Lc(Math.floor(Math.abs(c))+" KPH",7),a.da[1].text=s.Lc(Math.floor(30*b.W.G/Math.PI)+" "+["N","1","2","3","4","5","6",,,,"R"][b.s].toString(),7)):(a.da[0].ua=q,a.da[1].ua=q,a.da[2].ua=q);L.Sa(a.va);L.translate(a.va,[0.96,-0.8,-3.5]);L.rotate(a.va,-2,[0,1,0]);L.scale(a.va,[0.5,0.5,0.5]);for(d=a.da.length-1;0<=d;d--)e=a.da[d],e.ua&&(L.set(a.va,e.w),L.translate(e.w,e.m),L.Nb(e.w,e.fa),P.wb(e.fa))}r.wd=function(){this.la=1};
function Va(a){console.log("logout");var b,c;for(b in a.b.K)a.b.K.hasOwnProperty(b)&&(c=a.b.K[b],c!==p&&(Ya(c.dc,a.e),a.b.Qc[b]=a.t));a.b.Za.length=0;a.b.Na.length=0;a.b.md.length=0;a.b.K={};a.b.id=-1;a.Aa=-1;a.p=3;a.la=0;a.Fa=function(){this.J=0;N(this,this.J);this.h=-1;this.xa=3;this.p=-3;this.Fa=p;this.b.z=this.b.ya}}
r.update=function(a,b){var c=(b-this.time)/1E3;0.1<c?(c=Math.floor((c-this.$a)/this.$a),console.log("Skipping "+c+" frames"),this.t+=c,c=this.$a,this.hb=0):0>c&&(c=0);this.time=b;this.hb+=c;var d,e=this.b.K[this.b.id]&&this.b.K[this.b.id].o;if((d=this.b.K[this.b.id]&&this.b.K[this.b.id].dc)&&3===ua){var f=this.time%1E3/1E3;f<this.Ee&&(this.Rc=this.Zb,this.Zb=[1.2*Math.random()-0.1,1.2*Math.random()-0.1,1.2*Math.random()-0.1]);this.Ee=f;d.body.c[s.a.l]=[this.Zb[0]*f+this.Rc[0]*(1-f),this.Zb[1]*f+this.Rc[1]*
(1-f),this.Zb[2]*f+this.Rc[2]*(1-f)]}this.b.bf(this.C,a,c,z(a,a.yf)?20:200);this.b.z===this.b.ya&&this.b.cf(this.C,a,c);if((1===this.la||2===this.la)&&-1===this.J&&e)if(this.b.Vf(e,a),pa(a,a.If)||y(a,a.Ud))e.V[1]=this.na.pc(e.V[0],e.V[2]).bb+1,K.set([0,0,0],e.ia),Y.set([0,0.554,0,0.832],e.u),K.set([0,0,0],e.ra),e.i[0].U=0.001,e.i[1].U=0.001,e.i[2].U=0.001,e.i[3].U=0.001;y(a,a.wf)&&(this.u+=1);y(a,a.rf)&&(this.u-=1);z(a,a.Rd)&&(this.e.c[s.a.S][0]+=0.005,this.e.c[s.a.S][1]+=0.005,this.e.c[s.a.S][2]+=
0.005);z(a,a.Qd)&&(this.e.c[s.a.S][0]-=0.005,this.e.c[s.a.S][1]-=0.005,this.e.c[s.a.S][2]-=0.005);z(a,a.Xd)&&(this.e.c[s.a.T][0]+=0.005,this.e.c[s.a.T][1]+=0.005,this.e.c[s.a.T][2]+=0.005);z(a,a.Id)&&(this.e.c[s.a.T][0]-=0.005,this.e.c[s.a.T][1]-=0.005,this.e.c[s.a.T][2]-=0.005);if(pa(a,a.Kf)||y(a,a.Sd)){this.debug=!this.debug;for(d=0;d<this.b.Na.length;d++){var f=this.b.Na[d],g=this.debug,h=l;if(g===m){0===f.j.length&&Za(f);for(h=f.j.length-1;0<=h;h--)f.j[h].ua=m;f.Yb=m}else if(g===q){for(h=f.j.length-
1;0<=h;h--)f.j[h].ua=q;f.Yb=q}}}if(1===this.la||2===this.la)if(pa(a,a.Mf)||y(a,a.Jd))this.la=1===this.la?2:1;if(2===ua){var j,k,f=ra;ra=[];g=f.length;for(d=0;d<g;d++)if(j=f[d],"string"!==typeof j)a:{k=j;j=l;var o=new Uint8Array(k,0,12);j=(new Uint32Array(k,4,1))[0];if(67===o[0]&&68===o[1]){var n=256*o[2]+o[3],h=p;if(!this.b.K[n]){if(this.b.Qc[n]&&this.b.Qc[n]+500>this.t){console.log("Dead car driving "+n);break a}console.log("NEW car "+n);h=new Wa(o[8]);h.na=this.na;o=new Xa(h,this.b.$,this.debug);
this.e.add(o);this.b.Za.push(h);this.b.Na.push(o);this.b.K[n]={};this.b.K[n].o=h;this.b.K[n].dc=o}h=this.b.K[n].o;if(n!==this.b.id&&(j+=120,j>this.t)){h.Re.push({t:j,state:k});break a}if(!(400<this.t-j)){h.setData(k,8);k=h.Cc;for(n=0;k[0]&&k[0].t<j;)k.shift();for(;j<this.t;j++)k[n]&&k[n].t===j&&(h.F=k[n].F,h.v=k[n].v,h.q=k[n].q,n++),$a(h,this.$a)}}}else switch(h=j.split(" "),h[0]){case "HI!":break;case "HID":this.b.id=parseInt(h[1],10);console.log("New ID: "+this.b.id);break;case "LOG":if(this.b.z!==
this.b.Yc){console.log("Server LOG message not in place!");continue}"SUC"===h[1]?(this.f[6].text="Logged in!",K.set(this.Oa,this.f[6].c[s.a.l]),this.b.z=this.b.yb,this.Aa=-1,this.p=3,this.Fa=this.wd):(this.f[6].text=h.slice(2).join(" ").slice(0,16).toLowerCase(),K.set(this.nd,this.f[6].c[s.a.l]),this.b.z=this.b.ya);break;case "REG":if(this.b.z!==this.b.de){console.log("Server REG message not in place!");continue}"SUC"===h[1]?(this.f[6].text="Registered!",K.set(this.Oa,this.f[6].c[s.a.l]),this.b.z=
this.b.Yc,this.Aa=-1,this.p=3,this.Fa=this.wd):(this.f[6].text=h.slice(2).join(" ").slice(0,16).toLowerCase(),K.set(this.nd,this.f[6].c[s.a.l]),this.b.z=this.b.ya);break;case "POG":this.Hb.push((new Date).getTime()-this.Mc);if(20>this.Hb.length)this.Mc=(new Date).getTime();else if(20===this.Hb.length){this.ob=0;for(h=this.Hb.length-1;0<=h;h--)this.ob+=this.Hb[h];this.ob=Math.ceil(this.ob/this.Hb.length)}break;case "SIF":console.log("Synchronizing time with server "+h[1]);this.t=parseInt(h[1],10)+
Math.ceil(1.3*this.ob/2);break;case "OUT":j=parseInt(h[1],10);k=this.b.K[j];console.log("OUT "+j);k&&(Ya(k.dc,this.e),this.b.Za.splice(this.b.Za.indexOf(k.o),1),this.b.Na.splice(this.b.Na.indexOf(k.dc),1),this.b.K[j]=p,this.b.Qc[j]=this.t);break;case "CNT":j=parseInt(h[1],10);k=this.b.K[j];if(!k)continue;j=this.b.K[j].o;k=this.t-120;parseInt(h[2],10)<k?console.log("PC controll frame came "+(k-parseInt(h[2],10))+" frames too late"):j.Cc.push({t:parseInt(h[2],10)+120,F:parseFloat(h[3]),v:parseFloat(h[4]),
q:parseFloat(h[5])});break;case "LAG":console.log("High ping, slowing down");this.t+=1;break;case "GBC":console.log("Go buy a car");j=h=l;K.set([-312.256,1.68,18.914],this.C.position);K.set([-0.1,-2.59,0],this.C.rotation);this.C.ea=m;this.ic=0;this.b.z=this.b.sc;j=[1,2,3,4,5,6,9,11];n=k=p;for(h=0;h<j.length;h++)k=new Wa(j[h]),k.na=this.na,K.set([-298.39-8*h,0.388,25.159-0.3*h],k.V),n=new Xa(k,this.b.$,this.debug),this.e.add(n),this.Sc.push(k),this.Jb.push(n);for(h=0;400>h;h++)for(j=0;j<this.Sc.length;j++)$a(this.Sc[j],
this.b.fg);this.J=3;N(this,this.J);this.xa=1;this.p=-3;break;case "BOK":this.b.z=this.b.yb;this.J=-1;this.p=3;this.Fa=this.wd();h=l;for(h=this.Jb.length-1;0<=h;h--)Ya(this.Jb[h],this.e);this.Jb.length=0;this.Sc.length=0;break;default:console.log("Unknown message form server "+j)}0===this.Mc&&(this.Mc=(new Date).getTime())}this.b.z===this.b.sc&&(d=c,g=y(a,a.qc)||pa(a,a.be),h=y(a,a.rc)||pa(a,a.ce),j=y(a,a.Md)||pa(a,a.$d),k=y(a,a.Xc)||pa(a,a.ae),f=K.create(),0===this.ic?(g&&(this.Ca--,0>this.Ca&&(this.Ca=
7)),h&&(this.Ca++,7<this.Ca&&(this.Ca=0)),j&&(this.ic=1),this.f[1].text="<"+"Guolen B3;Ring Alpha;Gunter ULF;Hamer Head;Takamura F35;Biattino Arosa;Beat R500;Admin car".split(";")[this.Ca]+">",this.f[2].text="price:"+"22,000;21,000;25,000;92,300;52,000;100,000;60,000;over 9000".split(";")[this.Ca]+"\u20ac",this.f[3].text=""):1===this.ic&&(this.f[3].text="Are you shure?",k&&(this.ic=0),j&&console.log("BUY "+[1,2,3,4,5,6,9,11][this.Ca])),f[0]=-312.256+-8*(this.Ca-1),f[1]=1.68,f[2]=18.914+-0.3*(this.Ca-
1),g=this.C,h=0,h=20*K.we(g.position,f),K.direction(g.position,f,g.mc),s.qa.Ab(g.G,g.mc,-h*d),K.scale(g.G,0.8),s.qa.Ab(g.position,g.G,d),g.ea=m,this.C.ea=m);for(;this.hb>=this.$a;){this.hb-=this.$a;if(e&&2===ua&&(this.b.Ne!==e.F||this.b.Me!==e.v||this.b.Le!==e.q))d="CNT "+this.t+" "+e.F+" "+e.v+" "+e.q,d=d.split(" "),e.Cc.push({t:parseInt(d[1],10),F:parseFloat(d[2]),v:parseFloat(d[3]),q:parseFloat(d[4])}),e.F=parseFloat(d[2]),e.v=parseFloat(d[3]),e.q=parseFloat(d[4]),this.b.Ne=e.F,this.b.Me=e.v,this.b.Le=
e.q;for(d=0;d<this.b.Za.length;d++){f=this.b.Za[d];if(e!==f&&(h=f.Cc,g=f.Re,h[0]&&(h[0].t===this.t?(h=h.shift(),f.F=h.F,f.v=h.v,f.q=h.q):h[0].t<this.t&&h.shift()),g[0]))if(g[0].t===this.t){g=g.shift();f.setData(g.state,8);continue}else g[0].t<this.t&&g.shift();$a(this.b.Za[d],this.$a)}1===this.la&&this.b.K[this.b.id]&&(d=this.C,f=this.b.K[this.b.id].o.V,g=this.$a,h=h=0,h=K.we(d.position,f),h=40*(h-7),K.direction(d.position,f,d.mc),s.qa.Ab(d.G,d.mc,-h*g),K.scale(d.G,0.98),s.qa.Ab(d.position,d.G,g),
d.position[1]=f[1]+2,d.ea=m);this.t++}for(d=0;d<this.b.Na.length;d++)ab(this.b.Na[d]);1===this.la&&e&&this.C.Fe(e.V[0],e.V[1]+0.5,e.V[2]);2===this.la&&e&&(f=L.create(),L.Oe(this.C.ze,this.C.Ya,this.C.Ie,this.C.kb,f),L.translate(f,[0,-0.93,0.59]),L.multiply(f,e.ac,this.C.Ba),K.set(e.V,this.C.position),this.C.c[s.a.Ad]=[e.V[0],e.V[1],e.V[2]],this.ea=q);if(this.b.z===this.b.sc)for(d=0;d<this.Jb.length;d++)ab(this.Jb[d]);Ua(this,a,c);1===this.la&&e&&(L.set(e.ac,this.va),L.translate(this.va,[-1.5,-0.8,
3.5]),L.rotate(this.va,1.15,[0,1,0]),L.scale(this.va,[0.5,0.5,0.5]));c=0.001*(this.time-this.startTime-36E5);e=Math.sin(5.0E-4*c);d=Math.cos(5.0E-4*c);this.e.c[s.a.Cd][0]=c;this.Gc[0]=1*d-0*e;this.Gc[2]=1*e+0*d;for(d=0;d<this.b.md.length;d++)this.b.md[d].update(this.C)};
r.pb=function(a){if(a.pd){var b=a.d,c,d;for(d in a.Ra)a.Ra.hasOwnProperty(d)&&(c=a.Ra[d],c.width=a.width,c.height=a.height,b.bindFramebuffer(b.FRAMEBUFFER,c.Qa),b.bindTexture(b.TEXTURE_2D,c.Y),b.bindRenderbuffer(b.RENDERBUFFER,c.Pc),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,c.width,c.height,0,b.RGBA,c.type,p),b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,c.width,c.height));b.bindTexture(b.TEXTURE_2D,p);b.bindRenderbuffer(b.RENDERBUFFER,p);b.bindFramebuffer(b.FRAMEBUFFER,p);a.pd=q}if(this.b.Eb===
m){a.d.bindFramebuffer(a.d.FRAMEBUFFER,A(a,"scene").Qa);a.pb(this.e,this.C);a.d.clear(a.d.DEPTH_BUFFER_BIT);a.pb(this.Ha,this.$b);a.d.bindFramebuffer(a.d.FRAMEBUFFER,A(a,"depth").Qa);a.d.clear(a.d.COLOR_BUFFER_BIT|a.d.DEPTH_BUFFER_BIT);Ha(a,this.e,this.C);Ha(a,this.Ha,this.$b);b=A(a,"scene");c=A(a,"depth");var e=this.b.focus,f=1/1024;d=a.d;var g=C(a,"vgauss"),h=C(a,"hgauss"),j=A(a,"tgauss"),f="number"===typeof f?f:1/512,e="number"===typeof e?e:0.25;g.R&&h.R&&(d.bindFramebuffer(d.FRAMEBUFFER,j.Qa),
d.useProgram(g.X),a.za=g,J(g,"aVerPosition",a.Ka,3),g.bindTexture(0,b.Y),g.bindTexture(1,c.Y),d.uniform1i(g.M[g.Q.indexOf(s.a.Ea)],0),d.uniform1i(g.M[g.Q.indexOf(s.a.oc)],1),d.uniform1f(g.M[g.Q.indexOf(s.a.Te)],f),d.uniform1f(g.M[g.Q.indexOf(s.a.Ve)],e),d.disable(d.DEPTH_TEST),d.drawArrays(d.TRIANGLES,0,6),d.bindFramebuffer(d.FRAMEBUFFER,p),d.useProgram(h.X),a.za=h,J(h,"aVerPosition",a.Ka,3),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,j.Y),d.uniform1i(h.M[h.Q.indexOf(s.a.Ea)],0),d.uniform1i(h.M[h.Q.indexOf(s.a.oc)],
1),d.uniform1f(h.M[h.Q.indexOf(s.a.Te)],f),d.uniform1f(h.M[h.Q.indexOf(s.a.Ve)],e),d.drawArrays(d.TRIANGLES,0,6),d.enable(d.DEPTH_TEST))}else{a.d.bindFramebuffer(a.d.FRAMEBUFFER,A(a,"scene").Qa);a.pb(this.e,this.C);a.d.clear(a.d.DEPTH_BUFFER_BIT);a.pb(this.Ha,this.$b);switch(Math.abs(this.u)%6){case 0:c=G(a,"cmap_default.png",q);break;case 1:c=G(a,"cmap_contrast.png",q);break;case 2:c=G(a,"cmap_huesat.png",q);break;case 3:c=G(a,"cmap_invert.png",q);break;case 4:c=G(a,"cmap_tones.png",q);break;case 5:c=
G(a,"cmap_sepia.png",q);break;default:c=G(a,"cmap_default.png",q)}b=A(a,"scene");d=a.d;g=C(a,"colormap");g.R&&(d.useProgram(g.X),a.za=g,J(g,"aVerPosition",a.Ka,3),g.bindTexture(0,b.Y),d.uniform1i(g.M[g.Q.indexOf(s.a.Ea)],0),g.bindTexture(1,c.Y),d.uniform1i(g.M[g.Q.indexOf(s.a.oc)],1),d.disable(d.DEPTH_TEST),d.drawArrays(d.TRIANGLES,0,6),d.enable(d.DEPTH_TEST));a.d.bindFramebuffer(a.d.FRAMEBUFFER,A(a,"scene2").Qa);b=A(a,"scene");c=0.003;c=c===l?0:c;d=a.d;g=C(a,"aberration");g.R&&(d.useProgram(g.X),
a.za=g,J(g,"aVerPosition",a.Ka,3),g.bindTexture(0,b.Y),d.uniform1i(g.M[g.Q.indexOf(s.a.Ea)],0),d.uniform1f(g.M[g.Q.indexOf(s.a.Bd)],c),d.disable(d.DEPTH_TEST),d.drawArrays(d.TRIANGLES,0,6),d.enable(d.DEPTH_TEST));a.d.bindFramebuffer(a.d.FRAMEBUFFER,A(a,"add").Qa);b=A(a,"scene2");c=0.45-s.ma(0.005*K.length(this.C.G),0,0.25);c=c===l?0:c;d=a.d;g=C(a,"blend");g.R&&(d.useProgram(g.X),a.za=g,J(g,"aVerPosition",a.Ka,3),g.bindTexture(0,b.Y),d.uniform1i(g.M[g.Q.indexOf(s.a.Ea)],0),d.uniform1f(g.M[g.Q.indexOf(s.a.Bd)],
c),d.disable(d.DEPTH_TEST),d.enable(d.BLEND),d.drawArrays(d.TRIANGLES,0,6),d.enable(d.DEPTH_TEST),d.disable(d.BLEND));a.d.bindFramebuffer(a.d.FRAMEBUFFER,p);b=A(a,"add");c=a.d;d=C(a,"rbuffer");d.R&&(c.useProgram(d.X),a.za=d,J(d,"aVerPosition",a.Ka,3),d.bindTexture(0,b.Y),c.uniform1i(d.M[d.Q.indexOf(s.a.Ea)],0),c.disable(c.DEPTH_TEST),c.drawArrays(c.TRIANGLES,0,6),c.enable(c.DEPTH_TEST))}b=this.zg;c=a.d;d=C(a,"vignette");d.R&&(c.useProgram(d.X),a.za=d,Pa(d,"aVerPosition"),J(d,"aVerPosition",a.Ka,3),
c.uniform3fv(d.M[d.Q.indexOf(s.a.l)],b),c.uniform1f(d.M[d.Q.indexOf(s.a.Bd)],0.6),c.enable(c.BLEND),c.disable(c.DEPTH_TEST),c.colorMask(m,m,m,q),c.drawArrays(c.TRIANGLES,0,6),c.colorMask(m,m,m,m),c.enable(c.DEPTH_TEST),c.disable(c.BLEND));2E3>this.time-this.startTime&&(b=s.ma((2E3-this.time+this.startTime)/1400,0,1),b=Math.pow(b,1),c=a.d,d=C(a,"fade"),b===l&&(b=0.5),d.R&&(c.useProgram(d.X),a.za=d,J(d,"aVerPosition",a.Ka,3),c.uniform1f(d.M[d.Q.indexOf(s.a.Ue)],b),c.enable(c.BLEND),c.disable(c.DEPTH_TEST),
c.drawArrays(c.TRIANGLES,0,6),c.disable(c.BLEND),c.enable(c.DEPTH_TEST)));this.Qe++};var K={},P={},L={},Y={},bb=p;typeof Float32Array!==l?bb=Float32Array:bb=Array;"undefined"!==typeof exports&&(global.qa=K,global.Jg=P,global.Kg=L,global.td=Y);K.create=function(a){var b=new bb(3);if(a===l)b[0]=b[1]=b[2]=0;else{b[0]=a[0];b[1]=a[1];b[2]=a[2]}return b};K.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};K.add=function(a,b,c){if(!c||a===c){a[0]=a[0]+b[0];a[1]=a[1]+b[1];a[2]=a[2]+b[2];return a}c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};
K.Da=function(a,b,c){if(!c||a===c){a[0]=a[0]-b[0];a[1]=a[1]-b[1];a[2]=a[2]-b[2]}else{c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2]}};K.multiply=function(a,b,c){if(!c||a===c){a[0]=a[0]*b[0];a[1]=a[1]*b[1];a[2]=a[2]*b[2];return a}c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};K.Mg=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};K.scale=function(a,b,c){if(!c||a===c){a[0]=a[0]*b;a[1]=a[1]*b;a[2]=a[2]*b;return a}c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};
K.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f){b[0]=0;b[1]=0;b[2]=0;return b}if(f===1){b[0]=c;b[1]=d;b[2]=e;return b}f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;return b};K.ib=function(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],f=b[0],g=b[1],b=b[2];c[0]=e*b-a*g;c[1]=a*f-d*b;c[2]=d*g-e*f;return c};K.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};K.ja=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};
K.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b){c[0]=0;c[1]=0;c[2]=0;return c}b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c};K.Ig=function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d};K.we=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)};
K.Xg=function(a,b,c,d,e){e||(e=a);var f=L.create(),g=new bb(4);g[0]=(a[0]-d[0])*2/d[2]-1;g[1]=(a[1]-d[1])*2/d[3]-1;g[2]=2*a[2]-1;g[3]=1;L.multiply(c,b,f);if(!L.inverse(f))return p;L.jg(f,g);if(g[3]===0)return p;e[0]=g[0]/g[3];e[1]=g[1]/g[3];e[2]=g[2]/g[3];return e};K.Kb=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};P.create=function(a){var b=new bb(9);if(a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8]}return b};
P.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};P.Sa=function(a){a||(a=P.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};P.wb=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};
P.yd=function(a,b){b||(b=L.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};P.Kb=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};
L.create=function(a){var b=new bb(16);if(a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15]}return b};L.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};
L.Sa=function(a){a||(a=L.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
L.wb=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=f;a[11]=a[14];a[12]=e;a[13]=g;a[14]=h;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};
L.Fg=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],j=a[7],k=a[8],o=a[9],n=a[10],t=a[11],w=a[12],v=a[13],E=a[14],a=a[15];return w*o*h*e-k*v*h*e-w*g*n*e+f*v*n*e+k*g*E*e-f*o*E*e-w*o*d*j+k*v*d*j+w*c*n*j-b*v*n*j-k*c*E*j+b*o*E*j+w*g*d*t-f*v*d*t-w*c*h*t+b*v*h*t+f*c*E*t-b*g*E*t-k*g*d*a+f*o*d*a+k*c*h*a-b*o*h*a-f*c*n*a+b*g*n*a};
L.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],j=a[6],k=a[7],o=a[8],n=a[9],t=a[10],w=a[11],v=a[12],E=a[13],F=a[14],Q=a[15],Z=c*h-d*g,$=c*j-e*g,R=c*k-f*g,S=d*j-e*h,T=d*k-f*h,U=e*k-f*j,V=o*E-n*v,W=o*F-t*v,X=o*Q-w*v,fa=n*F-t*E,ga=n*Q-w*E,ha=t*Q-w*F,H=Z*ha-$*ga+R*fa+S*X-T*W+U*V;if(!H)return p;H=1/H;b[0]=(h*ha-j*ga+k*fa)*H;b[1]=(-d*ha+e*ga-f*fa)*H;b[2]=(E*U-F*T+Q*S)*H;b[3]=(-n*U+t*T-w*S)*H;b[4]=(-g*ha+j*X-k*W)*H;b[5]=(c*ha-e*X+f*W)*H;b[6]=(-v*U+F*R-Q*$)*H;b[7]=(o*U-t*R+
w*$)*H;b[8]=(g*ga-h*X+k*V)*H;b[9]=(-c*ga+d*X-f*V)*H;b[10]=(v*T-E*R+Q*Z)*H;b[11]=(-o*T+n*R-w*Z)*H;b[12]=(-g*fa+h*W-j*V)*H;b[13]=(c*fa-d*W+e*V)*H;b[14]=(-v*S+E*$-F*Z)*H;b[15]=(o*S-n*$+t*Z)*H;return b};L.Tg=function(a,b){b||(b=L.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
L.qg=function(a,b){b||(b=P.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};L.Nb=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],j=a[8],k=a[9],o=a[10],n=o*g-h*k,t=-o*f+h*j,w=k*f-g*j,v=c*n+d*t+e*w;if(v){v=1/v;b||(b=P.create());b[0]=n*v;b[1]=(-o*d+e*k)*v;b[2]=(h*d-e*g)*v;b[3]=t*v;b[4]=(o*c-e*j)*v;b[5]=(-h*c+e*f)*v;b[6]=w*v;b[7]=(-k*c+d*j)*v;b[8]=(g*c-d*f)*v}};
L.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],j=a[5],k=a[6],o=a[7],n=a[8],t=a[9],w=a[10],v=a[11],E=a[12],F=a[13],Q=a[14],a=a[15],Z=b[0],$=b[1],R=b[2],S=b[3],T=b[4],U=b[5],V=b[6],W=b[7],X=b[8],fa=b[9],ga=b[10],ha=b[11],H=b[12],ya=b[13],za=b[14],b=b[15];c[0]=Z*d+$*h+R*n+S*E;c[1]=Z*e+$*j+R*t+S*F;c[2]=Z*f+$*k+R*w+S*Q;c[3]=Z*g+$*o+R*v+S*a;c[4]=T*d+U*h+V*n+W*E;c[5]=T*e+U*j+V*t+W*F;c[6]=T*f+U*k+V*w+W*Q;c[7]=T*g+U*o+V*v+W*a;c[8]=X*d+fa*h+ga*n+ha*E;c[9]=X*e+fa*j+ga*t+ha*F;c[10]=
X*f+fa*k+ga*w+ha*Q;c[11]=X*g+fa*o+ga*v+ha*a;c[12]=H*d+ya*h+za*n+b*E;c[13]=H*e+ya*j+za*t+b*F;c[14]=H*f+ya*k+za*w+b*Q;c[15]=H*g+ya*o+za*v+b*a;return c};L.wa=function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c};
L.jg=function(a,b){var c;c||(c=b);var d=b[0],e=b[1],f=b[2],g=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*g;c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*g;c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*g;c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*g};
L.translate=function(a,b,c){var d=b[0],e=b[1],b=b[2],f,g,h,j,k,o,n,t,w,v,E,F;if(!c||a===c){a[12]=a[0]*d+a[4]*e+a[8]*b+a[12];a[13]=a[1]*d+a[5]*e+a[9]*b+a[13];a[14]=a[2]*d+a[6]*e+a[10]*b+a[14];a[15]=a[3]*d+a[7]*e+a[11]*b+a[15];return a}f=a[0];g=a[1];h=a[2];j=a[3];k=a[4];o=a[5];n=a[6];t=a[7];w=a[8];v=a[9];E=a[10];F=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=j;c[4]=k;c[5]=o;c[6]=n;c[7]=t;c[8]=w;c[9]=v;c[10]=E;c[11]=F;c[12]=f*d+k*e+w*b+a[12];c[13]=g*d+o*e+v*b+a[13];c[14]=h*d+n*e+E*b+a[14];c[15]=j*d+t*e+F*b+a[15];
return c};L.scale=function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a===c){a[0]=a[0]*d;a[1]=a[1]*d;a[2]=a[2]*d;a[3]=a[3]*d;a[4]=a[4]*e;a[5]=a[5]*e;a[6]=a[6]*e;a[7]=a[7]*e;a[8]=a[8]*b;a[9]=a[9]*b;a[10]=a[10]*b;a[11]=a[11]*b;return a}c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};
L.rotate=function(a,b,c,d){var e=c[0],f=c[1],c=c[2],g=Math.sqrt(e*e+f*f+c*c),h,j,k,o,n,t,w,v,E,F,Q,Z,$,R,S,T,U,V,W,X;if(!g)return p;if(g!==1){g=1/g;e=e*g;f=f*g;c=c*g}h=Math.sin(b);j=Math.cos(b);k=1-j;b=a[0];g=a[1];o=a[2];n=a[3];t=a[4];w=a[5];v=a[6];E=a[7];F=a[8];Q=a[9];Z=a[10];$=a[11];R=e*e*k+j;S=f*e*k+c*h;T=c*e*k-f*h;U=e*f*k-c*h;V=f*f*k+j;W=c*f*k+e*h;X=e*c*k+f*h;e=f*c*k-e*h;f=c*c*k+j;if(d){if(a!==d){d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15]}}else d=a;d[0]=b*R+t*S+F*T;d[1]=g*R+w*S+Q*T;d[2]=
o*R+v*S+Z*T;d[3]=n*R+E*S+$*T;d[4]=b*U+t*V+F*W;d[5]=g*U+w*V+Q*W;d[6]=o*U+v*V+Z*W;d[7]=n*U+E*V+$*W;d[8]=b*X+t*e+F*f;d[9]=g*X+w*e+Q*f;d[10]=o*X+v*e+Z*f;d[11]=n*X+E*e+$*f;return d};
L.Pg=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],f=a[5],g=a[6],h=a[7],j=a[8],k=a[9],o=a[10],n=a[11];if(c){if(a!==c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]}}else c=a;c[4]=e*b+j*d;c[5]=f*b+k*d;c[6]=g*b+o*d;c[7]=h*b+n*d;c[8]=e*-d+j*b;c[9]=f*-d+k*b;c[10]=g*-d+o*b;c[11]=h*-d+n*b;return c};
L.Qg=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],j=a[8],k=a[9],o=a[10],n=a[11];if(c){if(a!==c){c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]}}else c=a;c[0]=e*b+j*-d;c[1]=f*b+k*-d;c[2]=g*b+o*-d;c[3]=h*b+n*-d;c[8]=e*d+j*b;c[9]=f*d+k*b;c[10]=g*d+o*b;c[11]=h*d+n*b;return c};
L.Rg=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],j=a[4],k=a[5],o=a[6],n=a[7];if(c){if(a!==c){c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]}}else c=a;c[0]=e*b+j*d;c[1]=f*b+k*d;c[2]=g*b+o*d;c[3]=h*b+n*d;c[4]=e*-d+j*b;c[5]=f*-d+k*b;c[6]=g*-d+o*b;c[7]=h*-d+n*b;return c};
L.eg=function(a,b,c,d,e,f,g){g||(g=L.create());var h=b-a,j=d-c,k=f-e;g[0]=e*2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=e*2/j;g[6]=0;g[7]=0;g[8]=(b+a)/h;g[9]=(d+c)/j;g[10]=-(f+e)/k;g[11]=-1;g[12]=0;g[13]=0;g[14]=-(f*e*2)/k;g[15]=0};L.Oe=function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b=a*b;L.eg(-b,b,-a,a,c,d,e)};
L.Og=function(a,b,c,d,e,f,g){g||(g=L.create());var h=b-a,j=d-c,k=f-e;g[0]=2/h;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2/j;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2/k;g[11]=0;g[12]=-(a+b)/h;g[13]=-(d+c)/j;g[14]=-(f+e)/k;g[15]=1;return g};
L.Fe=function(a,b,c,d){d||(d=L.create());var e,f,g,h,j,k,o,n,t=a[0],w=a[1],a=a[2];g=c[0];h=c[1];f=c[2];o=b[0];c=b[1];e=b[2];if(t===o&&w===c&&a===e)return L.Sa(d);b=t-o;c=w-c;o=a-e;n=1/Math.sqrt(b*b+c*c+o*o);b=b*n;c=c*n;o=o*n;e=h*o-f*c;f=f*b-g*o;g=g*c-h*b;if(n=Math.sqrt(e*e+f*f+g*g)){n=1/n;e=e*n;f=f*n;g=g*n}else g=f=e=0;h=c*g-o*f;j=o*e-b*g;k=b*f-c*e;if(n=Math.sqrt(h*h+j*j+k*k)){n=1/n;h=h*n;j=j*n;k=k*n}else k=j=h=0;d[0]=e;d[1]=h;d[2]=b;d[3]=0;d[4]=f;d[5]=j;d[6]=c;d[7]=0;d[8]=g;d[9]=k;d[10]=o;d[11]=
0;d[12]=-(e*t+f*w+g*a);d[13]=-(h*t+j*w+k*a);d[14]=-(b*t+c*w+o*a);d[15]=1;return d};L.Gg=function(a,b,c){c||(c=L.create());var d=a[0],e=a[1],f=a[2],g=a[3],h=d+d,j=e+e,k=f+f,a=d*h,o=d*j,d=d*k,n=e*j,e=e*k,f=f*k,h=g*h,j=g*j,g=g*k;c[0]=1-(n+f);c[1]=o+g;c[2]=d-j;c[3]=0;c[4]=o-g;c[5]=1-(a+f);c[6]=e+h;c[7]=0;c[8]=d+j;c[9]=e-h;c[10]=1-(a+n);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c};
L.Kb=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};Y.create=function(a){var b=new bb(4);if(a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]}return b};Y.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};
Y.Eg=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b){a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return a}b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};Y.ja=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};Y.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],c=(c=c*c+d*d+e*e+f*f)?1/c:0;if(!b||a===b){a[0]=a[0]*-c;a[1]=a[1]*-c;a[2]=a[2]*-c;a[3]=a[3]*c;return a}b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};
Y.Wf=function(a,b){if(!b||a===b){a[0]=a[0]*-1;a[1]=a[1]*-1;a[2]=a[2]*-1}else{b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3]}};Y.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};Y.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(g===0){b[0]=0;b[1]=0;b[2]=0;b[3]=0;return b}g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;b[3]=f*g;return b};
Y.add=function(a,b,c){if(!c||a===c){a[0]=a[0]+b[0];a[1]=a[1]+b[1];a[2]=a[2]+b[2];a[3]=a[3]+b[3];return a}c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};Y.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],g=b[0],h=b[1],j=b[2],b=b[3];c[0]=d*b+a*g+e*j-f*h;c[1]=e*b+a*h+f*g-d*j;c[2]=f*b+a*j+d*h-e*g;c[3]=a*b-d*g-e*h-f*j;return c};
Y.wa=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=a[0],g=a[1],h=a[2],a=a[3],j=a*d+g*f-h*e,k=a*e+h*d-b*f,o=a*f+b*e-g*d,d=-b*d-g*e-h*f;c[0]=j*a+d*-b+k*-h-o*-g;c[1]=k*a+d*-g+o*-b-j*-h;c[2]=o*a+d*-h+j*-g-k*-b;return c};Y.scale=function(a,b,c){if(!c||a===c){a[0]=a[0]*b;a[1]=a[1]*b;a[2]=a[2]*b;a[3]=a[3]*b;return a}c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};
Y.qg=function(a,b){b||(b=P.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,j=e+e,k=c*g,o=c*h,c=c*j,n=d*h,d=d*j,e=e*j,g=f*g,h=f*h,f=f*j;b[0]=1-(n+e);b[1]=o+f;b[2]=c-h;b[3]=o-f;b[4]=1-(k+e);b[5]=d+g;b[6]=c+h;b[7]=d-g;b[8]=1-(k+n);return b};
Y.yd=function(a,b){b||(b=L.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,j=e+e,k=c*g,o=c*h,c=c*j,n=d*h,d=d*j,e=e*j,g=f*g,h=f*h,f=f*j;b[0]=1-(n+e);b[1]=o+f;b[2]=c-h;b[3]=0;b[4]=o-f;b[5]=1-(k+e);b[6]=d+g;b[7]=0;b[8]=c+h;b[9]=d-g;b[10]=1-(k+n);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
Y.Sg=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],f,g;if(Math.abs(e)>=1){if(d!==a){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3]}return d}f=Math.acos(e);g=Math.sqrt(1-e*e);if(Math.abs(g)<0.001){d[0]=a[0]*0.5+b[0]*0.5;d[1]=a[1]*0.5+b[1]*0.5;d[2]=a[2]*0.5+b[2]*0.5;d[3]=a[3]*0.5+b[3]*0.5;return d}e=Math.sin((1-c)*f)/g;c=Math.sin(c*f)/g;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};
Y.Kb=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};"undefined"!==typeof exports?global.B=global.B||{}:window.B=window.B||{};
function Wa(a){this.type=a;-1===this.type&&(a=[1,2,3,4,5,6,9,11],this.type=a[Math.floor(1E10*Math.random())%a.length]);this.V=K.create([417,0.338,-395.164]);this.ia=K.create([0,0,0]);this.u=Y.create();Y.set([0,0.554,0,0.832],this.u);this.ra=K.create([0,0,0]);this.Ic=1200;this.qd=1/this.Ic;this.ec=1200;this.q=this.v=this.F=0;this.s=1;this.Fb={10:-3.68,"0":0,1:4.06,2:2.4,3:1.58,4:1.19,5:1,6:0.87,9:3.8};this.Ae=0.75;this.W=new cb(this);this.Wb=K.create();this.Ob=K.create();this.Cb=L.create();this.ac=
L.create();this.lc=Y.create();this.mc=K.create();this.Ze=K.create();this.zd=K.create();this.xg=K.create();this.lc=Y.create();this.vd=Y.create();this.na=p;this.Cc=[];this.Re=[];var b=0,c=0,d=a=0,c=2,e=0.5,b=0,f=1;switch(this.type){case 1:e=0.6;c=2.578;a=0.74;d=0.25;b=1;f=0;break;case 2:e=0.57;c=2.615;a=0.72;d=0.25;b=0.4;f=0.6;break;case 3:e=0.5;c=2.761;a=0.75;d=0.25;break;case 4:e=0.53;c=2.7;a=0.8;d=0.3;break;case 5:e=0.5;c=2.78;a=0.79;d=0.3;break;case 6:e=0.5;c=2.65;a=0.83;d=0.35;break;case 9:e=0.39;
c=2.35;a=0.75;d=0.3;break;case 11:e=0.5;c=2.56;a=0.82;d=0.35;b=0.4;f=0.6;break;default:e=0.5,c=2.761,a=0.79,d=0.25,b=0,f=1,console.log("default car values loaded!")}this.Dc=0.5*b;this.Oc=0.5*f;b=-c*(1-e);c*=e;this.i=[];this.i[0]=new db([-a,d,b],1,this);this.i[1]=new db([a,d,b],-1,this);this.i[2]=new db([-a,d,c],1,this);this.i[3]=new db([a,d,c],-1,this)}
Wa.prototype.getData=function(a,b){var c=new Uint8Array(a,b,4),d=new Float32Array(a,b+4);c[0]=this.type;c[1]=this.s;var c=0,e;d[c++]=this.V[0];d[c++]=this.V[1];d[c++]=this.V[2];d[c++]=this.ia[0];d[c++]=this.ia[1];d[c++]=this.ia[2];d[c++]=this.u[0];d[c++]=this.u[1];d[c++]=this.u[2];d[c++]=this.u[3];d[c++]=this.ra[0];d[c++]=this.ra[1];d[c++]=this.ra[2];d[c++]=this.F;d[c++]=this.v;d[c++]=this.q;d[c++]=this.W.G;for(e=0;4>e;e++)d[c++]=this.i[e].rb,d[c++]=this.i[e].Lb,d[c++]=this.i[e].gc,d[c++]=this.i[e].U};
Wa.prototype.toString=function(){var a=[],b=new ArrayBuffer(136);this.getData(b,0);for(var c=new Uint8Array(b),b=0;272>b;b++){var d=c[Math.ceil(b/2)],d=b&1?d&15:d>>>4;switch(d){case 0:a[b]="0";break;case 1:a[b]="1";break;case 2:a[b]="2";break;case 3:a[b]="3";break;case 4:a[b]="4";break;case 5:a[b]="5";break;case 6:a[b]="6";break;case 7:a[b]="7";break;case 8:a[b]="8";break;case 9:a[b]="9";break;case 10:a[b]="a";break;case 11:a[b]="b";break;case 12:a[b]="c";break;case 13:a[b]="d";break;case 14:a[b]=
"e";break;case 15:a[b]="f";break;default:a[b]="x"}}return a.join("")};
Wa.prototype.setData=function(a,b){var c=new Uint8Array(a,b,4),d=new Float32Array(a,b+4);this.s=c[1];var c=0,e;this.V[0]=d[c++];this.V[1]=d[c++];this.V[2]=d[c++];this.ia[0]=d[c++];this.ia[1]=d[c++];this.ia[2]=d[c++];this.u[0]=d[c++];this.u[1]=d[c++];this.u[2]=d[c++];this.u[3]=d[c++];this.ra[0]=d[c++];this.ra[1]=d[c++];this.ra[2]=d[c++];this.F=d[c++];this.v=d[c++];this.q=d[c++];this.W.G=d[c++];for(e=0;4>e;e++)this.i[e].rb=d[c++],this.i[e].Lb=d[c++],this.i[e].gc=d[c++],this.i[e].U=d[c++]};
function $a(a,b){switch(a.s){case 10:0.01>=a.v&&(0.01<=a.F&&0.02>K.length(a.ia))&&(a.s=0);0.01>=a.v&&a.W.G<=a.W.Sb&&(a.s=0);break;case 0:0.01>=a.F&&0.5<=a.v&&0.1>K.length(a.ia)?a.s=10:a.W.G>a.W.Sb+200&&a.s++;0.01>a.F&&0.5>a.v&&(a.v=0.49);break;case 1:a.W.G>a.W.tc-10&&a.s++;a.W.G<a.W.Sb+10&&a.s--;break;case 2:case 3:case 4:case 5:a.W.G>a.W.tc-10&&a.s++;a.W.G/a.Fb[a.s]*a.Fb[a.s-1]<a.W.tc-100&&a.s--;break;case 6:a.W.G/a.Fb[a.s]*a.Fb[a.s-1]<a.W.tc-100&&a.s--;break;default:console.warn("invalid gear: "+
a.s)}a.i[0].Vc=a.q*a.Ae*(0<a.q?1.2:0.9)/(Math.pow(K.length(a.ia)/8,2)+1);a.i[1].Vc=a.q*a.Ae*(0>a.q?1.2:0.9)/(Math.pow(K.length(a.ia)/8,2)+1);K.set([0,0,0],a.Wb);K.set([0,0,0],a.Ob);var c=a.zd;Y.wa(a.u,a.ia,a.Ze);var d=a.Fb[a.s]*a.Fb[9],e=50*(a.W.G-(a.i[0].U*a.Dc+a.i[1].U*a.Dc+a.i[2].U*a.Oc+a.i[3].U*a.Oc)*d),e=Math.min(e,2E3);0===a.s&&(e=0);a.W.step(10===a.s?a.v:a.F,e,b);d=e*d/1;eb(a.i[0],d*a.Dc,b);eb(a.i[1],d*a.Dc,b);eb(a.i[2],d*a.Oc,b);eb(a.i[3],d*a.Oc,b);s.qa.Ab(a.Ob,a.ra,-0.001);s.qa.Ab(a.Wb,a.Ze,
-0.001);Y.wa(a.u,a.Wb);fb(a,[0,0,0],[0,9.8*-a.Ic,0]);d=K.length(a.ra);0<d&&(K.scale(a.ra,1/d,c),s.td(d*b,c,m,a.lc),Y.multiply(a.u,a.lc),Y.normalize(a.u),Y.Wf(a.u,a.vd));K.add(a.ra,K.scale(a.Ob,b/a.ec));K.add(a.V,K.scale(a.ia,b,c));K.add(a.ia,K.scale(a.Wb,b*a.qd,c));L.Sa(a.Cb);L.translate(a.Cb,a.V);L.multiply(a.Cb,Y.yd(a.u));a.ac=L.inverse(a.Cb,a.ac)}function fb(a,b,c){K.add(a.Wb,c);K.add(a.Ob,K.ib(b,c,a.zd))}
function cb(a){this.o=a;this.cg=0.1;this.dg=20;this.ec=0.2;this.rd=1/this.ec;this.Sb=105;this.tc=830;this.G=this.Sb;this.ve=[0,280,300,340,390,400,400,360,340,0]}cb.prototype.step=function(a,b,c){var a=this.Ob()*a,d=Math.min(this.G*this.cg,this.dg);this.G+=(a-d-b)*this.rd*c;this.G=Math.max(this.G,this.Sb)};cb.prototype.Ob=function(){var a=0.00955*this.G,b=Math.floor(a),c=Math.ceil(a);b===c&&c++;a-=b;b=s.ma(b,0,9);c=s.ma(c,0,9);return 2*(this.ve[b]*a+this.ve[c]*(1-a))};
function db(a,b,c){this.m=K.create(a);this.Ib=0.3305;this.Vc=0;this.rotate=b;this.o=c;this.oe=K.create();this.xe=K.create();this.Ic=10;this.qd=1/this.Ic;this.ec=10;this.rd=1/this.ec;this.Ge=0.18;this.jc=K.create([0,1,0]);this.rb=-0.1;this.xd=-0.2;this.Lb=0;this.ng=75E3;this.mg=8E3;this.Rb=K.create();this.Wc=K.create();this.Ed=K.create();this.Xf=K.create();this.ue=K.create();this.rg=K.create();this.sg=K.create();this.tg=K.create();this.ug=K.create();this.vg=K.create();this.wg=K.create();this.gc=0;
this.U=0.01}
function eb(a,b,c){var d=a.o.zd,e=a.o.xg,f,g=a.rg,h=a.Xf,j=a.ue,k,o,n,t=a.sg,w=a.tg,v=a.ug,E=a.Ed,F=a.vg;k=a.wg;o=0;K.set([0,0,0],a.Rb);K.set([0,0,0],v);f=a.ng*(a.rb-a.xd)+a.mg*a.Lb;4E4<Math.abs(f)&&(f=4E4*s.qb(f));L.wa(a.o.Cb,a.oe,F);Y.wa(a.o.u,a.jc,k);K.scale(k,-1);n=a.o.na;o=q;o=n.hc(F,k,2);o!==q&&(k=n.Gb,o=n.ta-a.Ib,n=n.Mb,1.0E-5>o&&(Y.wa(a.o.vd,k,t),K.add(F,K.scale(k,-a.Ib,d),j),L.wa(a.o.ac,j,h),Y.wa(a.o.vd,a.o.ia,g),K.add(g,K.ib(a.o.ra,h,d)),K.Da(g,K.scale(t,K.ja(t,g),d)),j=Math.min(2E6*-o,
8E4),K.scale(t,j,a.Rb),s.td(a.Vc,t,q,a.o.lc),Y.wa(a.o.lc,[0,0,-1],w),F=a.U*a.Ib-K.ja(g,w),k=K.length(g)||1.0E-4,1>k&&(k=Math.pow(k,0.001)),F=s.ma(F/k,-1*a.Ge,a.Ge),K.scale(w,F*(n?4:8)*j,a.Wc),K.ib(w,t,E),F=K.ja(g,E),g=K.ja(g,w)-a.U*a.Ib,1>Math.abs(g)&&(g=Math.pow(Math.abs(g),0.001)*(0<g?-1:1)),o=Math.atan(F/g)*(0<g?-1:1),o*=180/Math.PI,o=s.ma(o,-3.273,3.273),K.scale(E,o*(n?0.4891:0.8891)*j),K.add(v,a.Wc),K.add(v,E),K.add(v,a.Rb),K.Da(v,K.scale(t,K.ja(t,v),d),e),fb(a.o,h,e)));K.scale(a.jc,f,d);fb(a.o,
a.m,d);e=K.ja(v,w);50>Math.abs(e)&&(e=0);h=10===a.o.s?a.o.F:a.o.v;t=Math.min(500*a.U*h-e*h,5E3);w=2*a.U;a.rb+=a.Lb*c;a.Lb+=(K.ja(a.jc,a.Rb)-f)*a.qd*c;a.gc+=a.U*c;a.U+=(b-w-t-e)*a.rd*c;0.1>Math.abs(a.U)&&0.5<h&&(a.U=0);K.add(a.m,K.scale(a.jc,a.rb,d),a.oe);b=a.rb;0.15<b-a.xd&&(b=a.xd+0.15);K.add(a.m,K.scale(a.jc,b,d),a.xe)}
function Xa(a,b,c){this.o=a;this.$=b;this.d=b.d;this.Yb=c===m?m:q;this.bg=K.create();var d,e,f="admin_add.png",g,h,c=C(b,"car");this.e=p;switch(this.o.type){case 1:d="b3.obj";e="b3.png";f="b3_add.png";h=[0.7,0,0];g=K.create([0,0.36,1.54]);break;case 2:d="alpha.obj";e="alpha.png";f="alpha_add.png";h=[0,0,0.1];g=K.create([0,0.09,1.49]);break;case 3:d="ulf.obj";e="ulf.png";f="ulf_add.png";h=[0,0,0.1];g=K.create([0,0.02,1.38]);break;case 4:d="head.obj";e="head.png";f="head_add.png";h=[0.05,0,0];g=K.create([0,
0.07,1.43]);break;case 5:d="f35.obj";e="f35.png";f="f35_add.png";h=[0.129,0,0.26];g=K.create([0,0.07,1.39]);break;case 6:d="arosa.obj";e="arosa.png";f="arosa_add.png";h=[0.9,0.9,0.9];g=K.create([0,0.12,1.325]);break;case 9:d="r500.obj";e="r500.png";f="r500_add.png";h=[0.43,0.19,0.04];g=K.create([0,0.12,0.91]);break;case 11:d="admin.obj";e="admin.jpg";f="admin_add.jpg";h=[0.4,0.9,0];g=K.create([0,0.16,1.28]);break;default:d="ulf.obj",e="ulf.png",f="ulf_add.png",h=[0.43,0.19,0.04],g=K.create([0,0.27,
0.11]),console.log("wrong car type: "+a.type)}this.body=new M(I(b,d),c,G(b,e,q));this.body.tb=G(b,f,q);this.body.ub=G(b,"dangus.jpg");this.body.c[s.a.l]=h;this.body.m=g;e=G(b,"ratai.png",m,m);d=I(b,"ratai.obj");this.i=[];for(a=0;4>a;a++)this.i[a]=new M(d,c,e),this.i[a].tb=G(b,"ratai_add.png",q),this.i[a].ub=G(b,"dangus.jpg"),this.i[a].c[s.a.l]=[0.5,0.5,0.5];this.j=[];this.Yb&&Za(this)}
function Za(a){var b=C(a.$,"color");a.j[0]=new M(new gb(a.d),b);a.j[0].c[s.a.l]=[0,1,0];a.j[1]=new M(new gb(a.d),b);a.j[1].c[s.a.l]=[1,1,0];a.j[2]=new M(new gb(a.d),b);a.j[2].c[s.a.l]=[0,1,0];a.j[3]=new M(new gb(a.d),b);a.j[3].c[s.a.l]=[0,1,1];a.j[4]=new M(new gb(a.d),b);a.j[4].c[s.a.l]=[1,1,0];a.j[5]=new M(new gb(a.d),b);a.j[5].c[s.a.l]=[1,0,0];a.j[6]=new M(new gb(a.d),b);a.j[6].c[s.a.l]=[0,1,1];a.j[7]=new M(new gb(a.d),b);a.j[7].c[s.a.l]=[0,1,0];a.j[8]=new M(new gb(a.d),b);a.j[8].c[s.a.l]=[1,0,
0];a.j[9]=new M(new gb(a.d),b);a.j[9].c[s.a.l]=[1,0,1];a.j[10]=new M(new gb(a.d),b);a.j[10].c[s.a.l]=[0,0,1];a.j[11]=new M(new gb(a.d),b);a.j[11].c[s.a.l]=[1,0,0];if(a.e)for(b=a.j.length-1;0<=b;b--)a.e.add(a.j[b],m)}
function ab(a){var b=a.o.Cb,c=a.body.w,d=a.bg;L.set(b,c);L.translate(c,a.body.m);L.Nb(a.body.w,a.body.fa);P.wb(a.body.fa);for(c=0;4>c;c++){var e=a.i[c],f=e.w,g=a.o.i[c],h=g.ue;L.set(b,f);L.translate(f,g.xe);L.rotate(f,g.Vc,[0,1,0]);L.rotate(f,g.gc,[-1,0,0]);L.rotate(f,0.5*Math.PI*g.rotate,[0,0,1]);L.Nb(e.w,e.fa);P.wb(e.fa);a.Yb&&(Y.wa(a.o.u,g.Rb,d),K.scale(d,1/3E3),K.set(h,a.j[c].k.Kc),K.set(d,a.j[c].k.Nc),a.j[c].k.apply(),Y.wa(a.o.u,g.Wc,d),K.scale(d,1/3E3),K.set(h,a.j[c+4].k.Kc),K.set(d,a.j[c+4].k.Nc),
a.j[c+4].k.apply(),Y.wa(a.o.u,g.Ed,d),K.scale(d,1/3E3),K.set(h,a.j[c+8].k.Kc),K.set(d,a.j[c+8].k.Nc),a.j[c+8].k.apply())}}Xa.prototype.ne=function(a){this.e=a;a.add(this.body);a.add(this.i[0]);a.add(this.i[1]);a.add(this.i[2]);a.add(this.i[3]);var b,c;for(b=0;c=this.j[b];b++)a.add(c,m)};
function Ya(a,b){a.e=p;b.ha.splice(b.ha.indexOf(a.body),1);b.ha.splice(b.ha.indexOf(a.i[0]),1);b.ha.splice(b.ha.indexOf(a.i[1]),1);b.ha.splice(b.ha.indexOf(a.i[2]),1);b.ha.splice(b.ha.indexOf(a.i[3]),1);var c;if(a.Yb)for(c=a.j.length-1;0<=c;c--)b.jb.splice(b.jb.indexOf(a.j[c]),1)};"undefined"!==typeof exports?global.B=global.B||{}:window.B=window.B||{};s.od=function(a,b,c,d){return a*c+b*d};s.qb=function(a){return 0>a?-1:1};s.ma=function(a,b,c){return Math.min(c,Math.max(b,a))};s.td=function(a,b,c,d){c!==m&&K.normalize(b);a*=0.5;c=Math.sin(a);Y.set([b[0]*c,b[1]*c,b[2]*c,Math.cos(a)],d)};s.Lc=function(a,b){var c=s.ma(b-a.length,0,256);return Array(c+1).join(" "[0])+a};s.qa={};
s.qa.Kb=function(a,b){b===l&&(b=3);return"["+a[0].toFixed(b)+", "+a[1].toFixed(b)+", "+a[2].toFixed(b)+"]"};s.qa.lg=function(a,b){return(a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])+(a[2]-b[2])*(a[2]-b[2])};s.qa.Ab=function(a,b,c){a[0]+=b[0]*c;a[1]+=b[1]*c;a[2]+=b[2]*c};
s.Hc=function(a,b){if("undefined"===typeof exports){var c;c=new XMLHttpRequest;c.open("GET",a);c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0===c.status?b(c.responseText):(console.log(c.status),i(Error('Failed to load "'+a+'"'))))};c.send()}else fs.readFile(a,"utf-8",function(a,c){b(c)})};s.gg=function(){return"undefined"!==typeof exports};"undefined"!==typeof exports?global.B=global.B||{}:window.B=window.B||{};function M(a,b,c){this.k=a;this.oa=b;this.c=[];this.Pa=m;this.La=q;this.sb=c!==l?c:p;this.Tc=this.ub=this.tb=p;this.m=K.create();this.u=Y.create([0,0,0,1]);this.w=L.create();this.fa=P.create();this.ea=this.ua=m;this.L=0;this.kb=m}M.prototype.cd=function(){L.Sa(this.w);L.translate(this.w,this.m);L.multiply(this.w,Y.yd(this.u));L.Nb(this.w,this.fa);P.wb(this.fa);this.ea=q};function Ga(a){a.ea&&a.cd();return a.w}
function hb(){this.R=q;this.N={};this.c=[]}hb.prototype.zc=aa();function gb(a,b){hb.call(this);this.d=a;this.Kc=K.create([5,0,0]);this.Nc=K.create([0,10,0]);this.add=b===l?m:b;this.yg=new Float32Array(6);this.apply();this.R=m}
gb.prototype.apply=function(){var a=this.Kc,b=this.Nc,c=this.yg;c[0]=a[0];c[1]=a[1];c[2]=a[2];this.add?(c[3]=a[0]+b[0],c[4]=a[1]+b[1],c[5]=a[2]+b[2]):(c[3]=b[0],c[4]=b[1],c[5]=b[2]);a=this.d;this.N.sa=this.N.sa||a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.N.sa);a.bufferData(a.ARRAY_BUFFER,c,a.STREAM_DRAW)};gb.prototype.zc=function(a,b){Pa(b,"aVerPosition");J(b,"aVerPosition",this.N.sa,3);a.disable(a.DEPTH_TEST);a.drawArrays(a.LINES,0,2);a.enable(a.DEPTH_TEST)};
gb.prototype.zb=function(a,b){Pa(b,"aVerPosition");J(b,"aVerPosition",this.N.sa,3);a.disable(a.DEPTH_TEST);a.drawArrays(a.LINES,0,2);a.enable(a.DEPTH_TEST)};
function Na(a,b,c,d){hb.call(this);var e=this;this.d=a;this.ca=b;s.gg()||(this.c[s.a.Ea]=[0],this.c[s.a.oc]=[1],this.c[s.a.We]=[2],this.c[s.a.Xe]=[3]);this.root=c;this.Ia=this.A=this.ka=p;this.Bb=d===l?p:d;this.ba=0;this.ye=this.kc=this.fc=q;this.cb=this.O=this.P=p;this.og=K.create();this.Zf=K.create();this.Yf=K.create();this.Sf=K.create();this.Tf=K.create();this.Uf=K.create();this.pg=K.create();this.Xb=K.create();this.Gb=K.create();this.ta=0;s.Hc(this.ca,function(a){e.hd(a)})}
Na.prototype.hd=function(a){var b,c,d,e,f,g,h,j;j=[];var k=[],o=[],n=[];f=K.create();g=K.create();K.create();h=K.create();a=a.split("\n");for(c=0;c<a.length;c++)if(0!==a[c].length&&(b=a[c].split(" "),0!==b.length))switch(b[0]){case "v":4===b.length?(d=[parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])],!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?j.push(d):console.error("Bad vertex data in "+this.ca+":"+c)):console.error("Wrong vertex data count in "+this.ca+":"+c);break;case "f":this.ye||(this.fc=0<
n.length,this.kc=0<o.length,this.ye=m);4===b.length?(d=b[1].split("/"),e=b[2].split("/"),b=b[3].split("/"),d=[parseInt(d[0],10),parseInt(e[0],10),parseInt(b[0],10),parseInt(d[1],10),parseInt(e[1],10),parseInt(b[1],10),parseInt(d[2],10),parseInt(e[2],10),parseInt(b[2],10)],!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?k.push(d):console.error("Bad vertex data in "+this.ca+":"+c)):console.error("Wrong face data count in "+this.ca+":"+c);break;case "vt":3===b.length?(d=[parseFloat(b[1]),parseFloat(b[2])],
!isNaN(d[0])&&!isNaN(d[1])?o.push(d):console.error("Bad vertex texture data in "+this.ca+":"+c)):console.error("Bad vertex texture data in "+this.ca+":"+c);break;case "vn":4===b.length?(d=[parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])],!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?n.push(d):console.error("Bad vertex normal data in "+this.ca+":"+c)):console.error("Bad vertex normal data in "+this.ca+":"+c)}this.ba=k.length;this.P=new Float32Array(9*this.ba);this.fc===m&&(this.O=new Float32Array(9*
this.ba));this.kc===m&&(this.cb=new Float32Array(6*this.ba));if(this.root===m){this.ka=new Int16Array(3*this.ba);this.A=new Float32Array(3*j.length);this.Ia=new Float32Array(3*this.ba);for(a=0;a<this.ba;a++)this.ka[3*a]=k[a][0]-1,this.ka[3*a+1]=k[a][1]-1,this.ka[3*a+2]=k[a][2]-1;for(a=j.length-1;-1!==a;a-=1)this.A[3*a]=j[a][0],this.A[3*a+1]=j[a][1],this.A[3*a+2]=j[a][2];for(a=0;a<this.ba;a++)d=j[k[a][0]-1],e=j[k[a][1]-1],b=j[k[a][2]-1],K.Da(d,e,f),K.Da(e,b,g),K.ib(f,g,h),K.normalize(h),this.Ia[3*
a+0]=h[0],this.Ia[3*a+1]=h[1],this.Ia[3*a+2]=h[2]}for(a=0;a<this.ba;a++)if(d=j[k[a][0]-1],e=j[k[a][1]-1],b=j[k[a][2]-1],this.P[9*a]=d[0],this.P[9*a+1]=d[1],this.P[9*a+2]=d[2],this.P[9*a+3]=e[0],this.P[9*a+4]=e[1],this.P[9*a+5]=e[2],this.P[9*a+6]=b[0],this.P[9*a+7]=b[1],this.P[9*a+8]=b[2],this.fc&&(f=n[k[a][6]-1],g=n[k[a][7]-1],h=n[k[a][8]-1],this.O[9*a]=f[0],this.O[9*a+1]=f[1],this.O[9*a+2]=f[2],this.O[9*a+3]=g[0],this.O[9*a+4]=g[1],this.O[9*a+5]=g[2],this.O[9*a+6]=h[0],this.O[9*a+7]=h[1],this.O[9*
a+8]=h[2]),this.kc)f=o[k[a][3]-1],g=o[k[a][4]-1],h=o[k[a][5]-1],this.cb[6*a]=f[0],this.cb[6*a+1]=f[1],this.cb[6*a+2]=g[0],this.cb[6*a+3]=g[1],this.cb[6*a+4]=h[0],this.cb[6*a+5]=h[1];if("undefined"===typeof exports&&(j=this.d,this.N.sa=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,this.N.sa),j.bufferData(j.ARRAY_BUFFER,this.P,j.STATIC_DRAW),this.fc&&(this.N.Vb=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,this.N.Vb),j.bufferData(j.ARRAY_BUFFER,this.O,j.STATIC_DRAW)),this.kc))this.N.qe=j.createBuffer(),
j.bindBuffer(j.ARRAY_BUFFER,this.N.qe),j.bufferData(j.ARRAY_BUFFER,this.cb,j.STATIC_DRAW);var t=this;this.root?setTimeout(function(){var a;t.root=new ib(t);for(a=0;a<t.ba;a++)t.root.add(a);jb(t.root,0);if(t.Bb){t.Bb();t.Bb=p}},1):this.Bb&&(this.Bb(),this.Bb=p);this.R=m};
Na.prototype.zc=function(a,b,c){J(b,"aVerPosition",this.N.sa,3);if(b.attributes.aVerNormal!==l)if(this.fc===m)Pa(b,"aVerNormal"),J(b,"aVerNormal",this.N.Vb,3);else{var d=b.attributes.aVerNormal;d===l?console.warn("Bad shader attribute name!"):b.Ub[d]===m&&(b.Ja.disableVertexAttribArray(d),b.Ub[d]=q)}this.kc&&c.sb&&(Pa(b,"aTexCoord"),J(b,"aTexCoord",this.N.qe,2),b.bindTexture(0,c.sb.Y),c.tb&&b.bindTexture(1,c.tb.Y),c.ub&&b.bindTexture(2,c.ub.Y),c.Tc&&b.bindTexture(3,c.Tc.Y));a.drawArrays(a.TRIANGLES,
0,3*this.ba)};Na.prototype.zb=function(a,b){J(b,"aVerPosition",this.N.sa,3);a.drawArrays(a.TRIANGLES,0,3*this.ba)};function Ta(a,b,c){hb.call(this);var d=this;this.d=a;this.ca=b;this.ad=c===l?p:c;this.mb={"":0};this.size={};s.Hc(this.ca,function(a){d.hd(a)})}
Ta.prototype.hd=function(a){var b,c,d,e,f;f="";var g;g=[];var h=[],j=[],a=a.split("\n");for(c=0;c<a.length;c++)if(0!==a[c].length&&(b=a[c].split(" "),0!==b.length))switch(b[0]){case "g":this.mb[b[1][0]]=h.length;this.size[f]=h.length-this.mb[f];f=b[1][0];break;case "v":4===b.length?(d=[parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])],!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?g.push(d):console.error("Bad vertex data in "+this.ca+":"+c)):console.error("Wrong vertex data count in "+this.ca+":"+c);
break;case "vn":4===b.length?(d=[parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])],!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?j.push(d):console.error("Bad vertex normal data in "+this.ca+":"+c)):console.error("Bad vertex normal data in "+this.ca+":"+c);break;case "f":4===b.length?(d=b[1].split("/"),e=b[2].split("/"),b=b[3].split("/"),d=[parseInt(d[0],10),parseInt(e[0],10),parseInt(b[0],10),parseInt(d[1],10),parseInt(e[1],10),parseInt(b[1],10),parseInt(d[2],10),parseInt(e[2],10),parseInt(b[2],10)],
!isNaN(d[0])&&!isNaN(d[1])&&!isNaN(d[2])?h.push(d):console.error("Bad vertex data in "+this.ca+":"+c)):console.error("Wrong face data count in "+this.ca+":"+c)}this.size[f]=h.length-this.mb[f];this.ba=h.length;this.P=new Float32Array(9*this.ba);this.O=new Float32Array(9*this.ba);for(f=0;f<this.ba;f++)d=g[h[f][0]-1],e=g[h[f][1]-1],b=g[h[f][2]-1],this.P[9*f]=d[0],this.P[9*f+1]=d[1],this.P[9*f+2]=d[2],this.P[9*f+3]=e[0],this.P[9*f+4]=e[1],this.P[9*f+5]=e[2],this.P[9*f+6]=b[0],this.P[9*f+7]=b[1],this.P[9*
f+8]=b[2],a=j[h[f][6]-1],c=j[h[f][7]-1],d=j[h[f][8]-1],this.O[9*f]=-a[0],this.O[9*f+1]=-a[1],this.O[9*f+2]=-a[2],this.O[9*f+3]=-c[0],this.O[9*f+4]=-c[1],this.O[9*f+5]=-c[2],this.O[9*f+6]=-d[0],this.O[9*f+7]=-d[1],this.O[9*f+8]=-d[2];g=this.d;this.N.sa=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,this.N.sa);g.bufferData(g.ARRAY_BUFFER,this.P,g.STATIC_DRAW);this.N.Vb=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,this.N.Vb);g.bufferData(g.ARRAY_BUFFER,this.O,g.STATIC_DRAW);this.R=m;"function"==typeof this.ad&&
(this.ad(),this.ad=p)};Ta.prototype.zc=function(a,b,c){"string"!==typeof c.text&&i(Error("TextMesh objects must have a text string!"));var d=b.M[b.Q.indexOf(s.a.nc)];Pa(b,"aVerPosition");J(b,"aVerPosition",this.N.sa,3);Pa(b,"aVerNormal");J(b,"aVerNormal",this.N.Vb,3);for(b=0;b<c.text.length;b++){var e=c.text[b].toLowerCase();" "!==e&&(this.mb[e]===l&&(e="_"),a.uniform1i(d,b),a.drawArrays(a.TRIANGLES,3*this.mb[e],3*this.size[e]))}};
Ta.prototype.zb=function(a,b,c){"string"!==typeof c.text&&i(Error("TextMesh objects must have a text string!"));var d=b.M[b.Q.indexOf(s.a.nc)];Pa(b,"aVerPosition");J(b,"aVerPosition",this.N.sa,3);for(b=0;b<c.text.length;b++){var e=c.text[b].toLowerCase();" "!==e&&(this.mb[e]===l&&(e="_"),a.uniform1i(d,b),a.drawArrays(a.TRIANGLES,3*this.mb[e],3*this.size[e]))}};"undefined"!==typeof exports?global.B=global.B||{}:window.B=window.B||{};function ib(a){this.k=a;this.min=K.create();this.max=K.create();this.pa=[];this.Va=this.Wa=p;this.Xb=K.create();this.Gb=K.create();this.ta=0}ib.prototype.add=function(a){this.pa.push(a)};
function jb(a,b){var c,d,e,f,g,h,j,k;a.min[0]=1E10;a.min[1]=1E10;a.min[2]=1E10;a.max[0]=-1E10;a.max[1]=-1E10;a.max[2]=-1E10;for(c=0;c<a.pa.length;c++){d=3*a.pa[c];for(e=0;3>e;e++)for(g=0;3>g;g++)f=a.k.A[3*a.k.ka[d+e]+g],f>a.max[g]&&(a.max[g]=f),f<a.min[g]&&(a.min[g]=f)}0===a.pa.length&&console.log(0);if(2<a.pa.length&&50>b){c=a.max[0]-a.min[0]>a.max[2]-a.min[2]?0:2;d=(a.split=c)?(a.max[2]+a.min[2])/2:(a.max[0]+a.min[0])/2;k=c?(a.max[2]-a.min[2])/4:(a.max[0]-a.min[0])/4;a.Wa=new ib(a.k);a.Va=new ib(a.k);
for(j=[];(e=a.pa.pop())!==l;)g=h=a.k.A[3*a.k.ka[3*e]+c],f=a.k.A[3*a.k.ka[3*e+1]+c],f<g&&(g=f),f>h&&(h=f),f=a.k.A[3*a.k.ka[3*e+2]+c],f<g&&(g=f),f>h&&(h=f),d-g>k&&h-d>k?j.push(e):d-g>h-d?a.Va.add(e):a.Wa.add(e);a.pa=j;0===a.Wa.pa.length?a.Wa=p:jb(a.Wa,b+1);0===a.Va.pa.length?a.Va=p:jb(a.Va,b+1)}}
ib.prototype.pc=function(a,b){if(a<this.min[0]||a>this.max[0]||b>this.max[2]||b<this.min[2])return q;var c,d=-100,e=[0,1,0],f;for(f=this.pa.length-1;0<=f;f--){var g=this.pa[f],h=c=l,j=l,k=j=l,k=j=h=l,g=g+g+g,k=this.k,j=3*k.ka[g];c=[k.A[j++],k.A[j++],k.A[j]];j=3*k.ka[g+1];h=[k.A[j++],k.A[j++],k.A[j]];0<s.od(a-c[0],b-c[2],c[2]-h[2],h[0]-c[0])?c=q:(j=3*k.ka[g+2],j=[k.A[j++],k.A[j++],k.A[j]],0<s.od(a-h[0],b-h[2],h[2]-j[2],j[0]-h[0])||0<s.od(a-j[0],b-j[2],j[2]-c[2],c[0]-j[0])?c=q:(h=k.Ia[g++],j=k.Ia[g++],
k=k.Ia[g],c=0===h&&0===j&&0===k?q:{r:(h*a+k*b-(h*c[0]+j*c[1]+k*c[2]))/-j,n:[h,j,k]}));c!==q&&c.bb>d&&(d=c.bb,e=c.sd)}this.Wa!==p&&(c=this.Wa.pc(a,b),c!==q&&c.bb>d&&(d=c.bb,e=c.sd));this.Va!==p&&(c=this.Va.pc(a,b),c!==q&&c.bb>d&&(d=c.bb,e=c.sd));return{r:d,n:e}};
ib.prototype.hc=function(a,b,c){c!==l?this.k.ta=c:c=this.k.ta;var d,e=100000.1,f=-100000.1,g,h;for(d=2;0<=d;d--)if(0===b[d]){if(a[d]<this.min[d]||a[d]>this.max[d])return q}else if(g=(this.min[d]-a[d])/b[d],h=(this.max[d]-a[d])/b[d],g>h?(h>f&&(f=h),g<e&&(e=g)):(g>f&&(f=g),h<e&&(e=h)),f>e||0>=e||f>c)return q;for(d=this.pa.length-1;0<=d;d--){e=a;f=b;g=this.pa[d];var j=g+g+g,k=l;g=l;g=this.k;h=g.og;var o=g.Zf,n=g.Yf,t=g.pg,w=g.Sf,v=g.Tf,E=g.Uf,k=3*g.ka[j];w[0]=g.A[k++];w[1]=g.A[k++];w[2]=g.A[k];k=3*g.ka[j+
1];v[0]=g.A[k++];v[1]=g.A[k++];v[2]=g.A[k];k=3*g.ka[j+2];E[0]=g.A[k++];E[1]=g.A[k++];E[2]=g.A[k];t[0]=g.Ia[j++];t[1]=g.Ia[j++];t[2]=g.Ia[j];j=K.ja(t,f);0!==j&&(j=-1*(K.ja(e,t)+-1*K.ja(t,w))/j,j>=g.ta||0>j||(K.scale(f,j,h),K.add(h,e),K.Da(w,v,n),K.ib(n,t),K.Da(h,w,o),0>K.ja(n,o)||(K.Da(v,E,n),K.ib(n,t),K.Da(h,v,o),0>K.ja(n,o)||(K.Da(E,w,n),K.ib(n,t),K.Da(h,E,o),0>K.ja(n,o)||(K.set(h,g.Xb),K.set(t,g.Gb),g.ta=j)))))}this.Wa!==p&&this.Wa.hc(a,b);this.Va!==p&&this.Va.hc(a,b);return this.k.ta===c?q:m};
function Sa(){this.ab=[];this.root={};this.Xb=K.create();this.Gb=K.create();this.Mb=this.ta=0}Sa.prototype.hc=function(a,b,c){var d,e=q;this.ta=c;for(c=this.ab.length-1;0<=c;c--)d=this.ab[c],d.root.hc(a,b,this.ta)===m&&(K.set(d.Xb,this.Xb),K.set(d.Gb,this.Gb),this.ta=d.ta,this.Mb=d.Mb,e=m);return e};Sa.prototype.pc=function(a,b){var c,d,e=-100,f=[0,1,0];for(c=this.ab.length-1;0<=c;c--)d=this.ab[c],d=d.root.pc(a,b),d!==q&&d.bb>e&&(e=d.bb,f=d.sd);return{r:e,n:f}};
